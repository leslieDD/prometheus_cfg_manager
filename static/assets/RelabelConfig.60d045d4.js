import{C as e}from"./lint.624d88ac.js";import"./monokai.8bdeb9d9.js";import"./yaml.111f68d9.js";import{y as t,p as l,j as i,r as a,o as s,c as o,a as d,w as n,l as r,t as c,q as h,k as b}from"./vendor.684f159e.js";import{j as u}from"./js-yaml.039310f8.js";import{g as p,p as m,a as g,d as f,c as C,b as y,e as R}from"./relabel.720a46d2.js";import"./request.c24bac87.js";import"./index.6f2c4da2.js";window.jsyaml=u;const V={name:"ymalRelabelEdit",data:()=>({yamlRelabelEdit:!1,value:"",ReLabels:[],editRelabelInfo:{id:0,name:""},postCodeButVisable:{},editCodeButVisable:{},defaultRuleID:0,pageSize:10,pageTotal:0,currentPage:1,searchContent:"",deleteVisible:{},dialogVisible:!1,buttonTitle:"",dialogTitle:"",rules:{name:[{required:!0,message:"请输入正确的名称",validator:function(e,t,l){if(""===t||void 0===t||null==t)l(new Error("请输入正确名称"));else{/\s+/.test(t)?l(new Error("名称中不允许有空字符")):l()}},trigger:["blur"]}]}}),mounted(){this.yamlRelabelEdit=t(e.fromTextArea(this.$refs.textareaREdit,{mode:"text/x-yaml",indentUnit:2,smartIndent:!0,styleActiveLine:!0,lineNumbers:!0,theme:"idea",keyMap:"sublime",lineWrapping:!1,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:!0,fullScreen:!1,matchBrackets:!0,autoCloseBrackets:!0,extraKeys:{F11:e=>{e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:e=>{e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}},scrollbarStyle:"native"})),this.yamlRelabelEdit.refresh(),this.yamlRelabelEdit.setSize("1120px","50vh"),this.yamlRelabelEdit.setValue(this.value),this.yamlRelabelEdit.on("change",(e=>{this.$emit("changed",e.getValue()),this.$emit("input",e.getValue())})),this.doGetReLabels()},methods:{doAdd(){this.editRelabelInfo={id:0,name:""},this.buttonTitle="创建",this.dialogTitle="增加重写标签",this.dialogVisible=!0},doGetReLabels(e){e||(e={pageNo:this.currentPage,pageSize:this.pageSize,search:this.searchContent}),p(e).then((e=>{this.postCodeButVisable={},e.data.data.forEach((e=>{this.postCodeButVisable[e.id]=!0,"空规则"===e.name?this.editCodeButVisable[e.id]=!0:this.editCodeButVisable[e.id]=!1})),this.ReLabels=e.data.data,this.pageTotal=e.data.totalCount,this.currentPage=e.data.pageNo,this.pageSize=e.data.pageSize})).catch((e=>{console.log(e)}))},doEdit(e){this.buttonTitle="更新",this.dialogTitle="编辑标签",this.editRelabelInfo.id=e.row.id,this.editRelabelInfo.name=e.row.name,this.dialogVisible=!0},handleSizeChange(e){let t={pageNo:this.currentPage,pageSize:e,search:this.searchContent};this.doGetReLabels(t)},handleCurrentChange(e){let t={pageNo:e,pageSize:this.pageSize,search:this.searchContent};this.doGetReLabels(t)},handleClose(e){this.dialogVisible=!1},onSubmit(e){this.$refs[e].validate((t=>{if(!t)return!1;{let t={};t.name=this.editRelabelInfo.name,"创建"===this.buttonTitle?m(t).then((t=>{this.$notify({title:"成功",message:"创建成功！",type:"success"}),this.doGetReLabels(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>{console.log(e)})):(t.id=this.editRelabelInfo.id,g(t).then((t=>{this.$notify({title:"成功",message:"更新成功！",type:"success"}),this.doGetReLabels(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>{console.log(e)})))}}))},onCancel(e){this.dialogVisible=!1,this.$refs[e].resetFields()},onSearch(){this.doGetReLabels()},parseTimeSelf(e){var t=new Date(Date.parse(e));return t.toLocaleDateString()+" "+t.toTimeString().split(" ")[0]},doYes(e){f({id:e.row.id}).then((e=>{this.$notify({title:"成功",message:"删除成功！",type:"success"}),this.doGetReLabels()})).catch((e=>{console.log(e)})),this.deleteVisible[e.$index]=!1},doNo(e){this.deleteVisible[e.$index]=!1},doDelete(e){this.deleteVisible[e.$index]=!0},rowStyle:e=>({padding:"0"}),cellStyle:e=>({padding:"0"}),refresh(){this.yamlRelabelEdit.refresh()},doEditReLablesCode(e){C().then((t=>{Object.keys(this.postCodeButVisable).forEach((t=>{t!==e.row.id&&(this.postCodeButVisable[t]=!0)})),this.yamlRelabelEdit.setValue(e.row.code),this.postCodeButVisable[e.row.id]=!1})).catch((e=>console.log(e)))},doPostReLablesCode(e){const t={id:e.row.id,code:this.yamlRelabelEdit.getValue()};y(t).then((e=>{this.$notify({title:"成功",message:"提交成功！",type:"success"}),this.doGetReLabels()})).catch((e=>{console.log(e)}))},invocate(e){const t=!this.ReLabels[e.$index].enabled,l={id:e.row.id,enabled:t};R(l).then((l=>{this.$notify({title:"成功",message:"更新状态成功！",type:"success"}),this.ReLabels[e.$index].enabled=t,this.ReLabels=[...this.ReLabels]})).catch((e=>console.log(e)))}}},w=b();l("data-v-5be87940");const v={class:"relabel-config-box"},z={class:"main-content"},S={class:"do_action"},k={style:{"padding-right":"15px"}},x=r("添加"),_={class:"table-show"},L={class:"actioneara"},E=r("编辑名称"),$=r("编辑规则"),B=r("提交规则"),T=r("禁用"),I=r("启用"),j=d("p",null,"确定删除吗？",-1),G={style:{"text-align":"right",margin:"0"}},N=r("取消"),P=r("确定"),D=r("删除"),O={class:"block"},A={class:"yaml-relabel-edit"},F={ref:"textareaREdit"},M=r("取消");i();const U=w(((e,t,l,i,b,u)=>{const p=a("el-button"),m=a("el-input"),g=a("el-table-column"),f=a("el-popover"),C=a("el-table"),y=a("el-pagination"),R=a("el-form-item"),V=a("el-form"),U=a("el-dialog");return s(),o("div",v,[d("div",z,[d("div",null,[d("div",S,[d("div",k,[d(p,{size:"small",type:"success",plain:"",onClick:t[1]||(t[1]=e=>u.doAdd())},{default:w((()=>[x])),_:1})]),d("div",null,[d(m,{size:"small",placeholder:"请输入内容",onKeyup:t[3]||(t[3]=n((e=>u.onSearch()),["enter"])),modelValue:b.searchContent,"onUpdate:modelValue":t[4]||(t[4]=e=>b.searchContent=e)},{append:w((()=>[d(p,{size:"small",onClick:t[2]||(t[2]=e=>u.onSearch()),icon:"el-icon-search"})])),_:1},8,["modelValue"])])]),d("div",_,[d(C,{size:"mini","highlight-current-row":"",border:"",data:b.ReLabels,stripe:"","row-style":u.rowStyle,"cell-style":u.cellStyle},{default:w((()=>[d(g,{label:"序号",width:"50px"},{default:w((e=>[r(c(e.$index+1),1)])),_:1}),d(g,{label:"名称",prop:"name"}),d(g,{label:"最后更新时间",prop:"update_at"},{default:w((({row:e})=>[d("span",null,c(u.parseTimeSelf(e.update_at)),1)])),_:1}),d(g,{label:"操作",align:"center",width:"400px"},{default:w((e=>[d("div",L,[d("div",null,[d(p,{size:"mini",type:"primary",onClick:t=>u.doEdit(e),plain:"",disabled:b.editCodeButVisable[e.row.id]},{default:w((()=>[E])),_:2},1032,["onClick","disabled"])]),d("div",null,[d(p,{size:"mini",type:"primary",onClick:t=>u.doEditReLablesCode(e),disabled:b.editCodeButVisable[e.row.id],plain:""},{default:w((()=>[$])),_:2},1032,["onClick","disabled"])]),d("div",null,[d(p,{size:"mini",type:"warning",disabled:b.postCodeButVisable[e.row.id],onClick:t=>u.doPostReLablesCode(e)},{default:w((()=>[B])),_:2},1032,["disabled","onClick"])]),d("div",null,[!0===e.row.enabled?(s(),o(p,{key:0,size:"mini",type:"info",onClick:t=>u.invocate(e),plain:"",disabled:b.editCodeButVisable[e.row.id]},{default:w((()=>[T])),_:2},1032,["onClick","disabled"])):h("",!0),!1===e.row.enabled?(s(),o(p,{key:1,size:"mini",type:"warning",onClick:t=>u.invocate(e),plain:"",disabled:b.editCodeButVisable[e.row.id]},{default:w((()=>[I])),_:2},1032,["onClick","disabled"])):h("",!0)]),d("div",null,[d(f,{visible:b.deleteVisible[e.$index],placement:"top"},{reference:w((()=>[d(p,{size:"mini",type:"danger",plain:"",onClick:t=>u.doDelete(e),disabled:b.editCodeButVisable[e.row.id]},{default:w((()=>[D])),_:2},1032,["onClick","disabled"])])),default:w((()=>[j,d("div",G,[d(p,{size:"mini",type:"text",onClick:t=>u.doNo(e)},{default:w((()=>[N])),_:2},1032,["onClick"]),d(p,{type:"primary",size:"mini",onClick:t=>u.doYes(e)},{default:w((()=>[P])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])])])),_:1})])),_:1},8,["data","row-style","cell-style"]),d("div",O,[d(y,{onSizeChange:u.handleSizeChange,onCurrentChange:u.handleCurrentChange,"current-page":b.currentPage,"page-sizes":[10],"page-size":b.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:b.pageTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])]),d("div",A,[d("textarea",F,null,512)])]),d(U,{title:b.dialogTitle,modelValue:b.dialogVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>b.dialogVisible=e),width:"400px",modal:"","before-close":u.handleClose},{default:w((()=>[d("span",null,[d(V,{"label-position":"right",rules:b.rules,ref:"editRelabelInfo",model:b.editRelabelInfo,"label-width":"90px",size:"small"},{default:w((()=>[d(R,{label:"标签名：",prop:"name"},{default:w((()=>[d(m,{style:{width:"230px"},modelValue:b.editRelabelInfo.name,"onUpdate:modelValue":t[5]||(t[5]=e=>b.editRelabelInfo.name=e)},null,8,["modelValue"])])),_:1}),d(R,{size:"small"},{default:w((()=>[d(p,{size:"small",type:"primary",onClick:t[6]||(t[6]=e=>u.onSubmit("editRelabelInfo"))},{default:w((()=>[r(c(b.buttonTitle),1)])),_:1}),d(p,{size:"small",type:"info",onClick:t[7]||(t[7]=e=>u.onCancel("editRelabelInfo"))},{default:w((()=>[M])),_:1})])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue","before-close"])])}));V.render=U,V.__scopeId="data-v-5be87940";export default V;
