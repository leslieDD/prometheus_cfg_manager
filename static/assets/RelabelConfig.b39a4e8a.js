import{C as e}from"./lint.d7baeab5.js";import"./monokai.ca31d34e.js";import"./yaml.5eafab3c.js";import{m as t,p as l,b as i,r as a,o as s,c as o,a as d,h as n,j as r,t as c,k as h,w as b}from"./vendor.61ee7ef1.js";import{j as u}from"./js-yaml.37a6bd33.js";import{a as p,p as m,b as g,d as f,c as C,e as y}from"./relabel.902192cc.js";import"./request.0c690da8.js";window.jsyaml=u;const R={name:"ymalRelabelEdit",data:()=>({yamlRelabelEdit:!1,value:"",ReLabels:[],editRelabelInfo:{id:0,name:""},postCodeButVisable:{},editCodeButVisable:{},defaultRuleID:0,pageSize:10,pageTotal:0,currentPage:1,searchContent:"",deleteVisible:{},dialogVisible:!1,buttonTitle:"",dialogTitle:"",rules:{name:[{required:!0,message:"请输入正确的名称",validator:function(e,t,l){if(""===t||void 0===t||null==t)l(new Error("请输入正确名称"));else{/\s+/.test(t)?l(new Error("名称中不允许有空字符")):l()}},trigger:["blur"]}]}}),mounted(){this.yamlRelabelEdit=t(e.fromTextArea(this.$refs.textareaREdit,{mode:"text/x-yaml",indentUnit:2,smartIndent:!0,styleActiveLine:!0,lineNumbers:!0,theme:"idea",keyMap:"sublime",lineWrapping:!1,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:!0,fullScreen:!1,matchBrackets:!0,autoCloseBrackets:!0,extraKeys:{F11:e=>{e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:e=>{e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}},scrollbarStyle:"native"})),this.refresh(),this.yamlRelabelEdit.setValue(this.value),this.yamlRelabelEdit.on("change",(e=>{this.$emit("changed",e.getValue()),this.$emit("input",e.getValue())})),this.doGetReLabels()},methods:{doAdd(){this.editRelabelInfo={id:0,name:""},this.buttonTitle="创建",this.dialogTitle="增加重写标签",this.dialogVisible=!0},doGetReLabels(e){e||(e={pageNo:this.currentPage,pageSize:this.pageSize,search:this.searchContent}),p(e).then((e=>{this.postCodeButVisable={},e.data.data.forEach((e=>{this.postCodeButVisable[e.id]=!0,"空规则"===e.name?this.editCodeButVisable[e.id]=!0:this.editCodeButVisable[e.id]=!1})),this.ReLabels=e.data.data,this.pageTotal=e.data.totalCount,this.currentPage=e.data.pageNo,this.pageSize=e.data.pageSize})).catch((e=>{console.log(e)}))},doEdit(e){this.buttonTitle="更新",this.dialogTitle="编辑标签",this.editRelabelInfo.id=e.row.id,this.editRelabelInfo.name=e.row.name,this.dialogVisible=!0},handleSizeChange(e){let t={pageNo:this.currentPage,pageSize:e,search:this.searchContent};this.doGetReLabels(t)},handleCurrentChange(e){let t={pageNo:e,pageSize:this.pageSize,search:this.searchContent};this.doGetReLabels(t)},handleClose(e){this.dialogVisible=!1},onSubmit(e){this.$refs[e].validate((t=>{if(!t)return!1;{let t={};t.name=this.editRelabelInfo.name,"创建"===this.buttonTitle?m(t).then((t=>{this.$notify({title:"成功",message:"创建成功！",type:"success"}),this.doGetReLabels(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>{console.log(e)})):(t.id=this.editRelabelInfo.id,g(t).then((t=>{this.$notify({title:"成功",message:"更新成功！",type:"success"}),this.doGetReLabels(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>{console.log(e)})))}}))},onCancel(e){this.dialogVisible=!1,this.$refs[e].resetFields()},onSearch(){this.doGetReLabels()},parseTimeSelf(e){var t=new Date(Date.parse(e));return t.toLocaleDateString()+" "+t.toTimeString().split(" ")[0]},doYes(e){f({id:e.row.id}).then((e=>{this.$notify({title:"成功",message:"删除成功！",type:"success"}),this.doGetReLabels()})).catch((e=>{console.log(e)})),this.deleteVisible[e.$index]=!1},doNo(e){this.deleteVisible[e.$index]=!1},doDelete(e){this.deleteVisible[e.$index]=!0},rowStyle:e=>({padding:"0"}),cellStyle:e=>({padding:"0"}),refresh(){this.yamlRelabelEdit.refresh()},doEditReLablesCode(e){Object.keys(this.postCodeButVisable).forEach((t=>{t!==e.row.id&&(this.postCodeButVisable[t]=!0)})),this.yamlRelabelEdit.setValue(e.row.code),this.postCodeButVisable[e.row.id]=!1},doPostReLablesCode(e){const t={id:e.row.id,code:this.yamlRelabelEdit.getValue()};C(t).then((e=>{this.$notify({title:"成功",message:"提交成功！",type:"success"}),this.doGetReLabels()})).catch((e=>{console.log(e)}))},invocate(e){const t=!this.ReLabels[e.$index].enabled,l={id:e.row.id,enabled:t};y(l).then((l=>{this.$notify({title:"成功",message:"更新状态成功！",type:"success"}),this.ReLabels[e.$index].enabled=t,this.ReLabels=[...this.ReLabels]})).catch((e=>console.log(e)))}}},V=b();l("data-v-b0f31f00");const w={class:"relabel-config-box"},v={class:"main-content"},z={class:"do_action"},S={style:{"padding-right":"15px"}},k=r("添加"),_={class:"table-show"},x={class:"actioneara"},L=r("编辑名称"),E=r("编辑规则"),$=r("提交规则"),B=r("禁用"),T=r("启用"),I=d("p",null,"确定删除吗？",-1),j={style:{"text-align":"right",margin:"0"}},G=r("取消"),N=r("确定"),P=r("删除"),D={class:"block"},O={class:"yaml-relabel-edit"},A={ref:"textareaREdit"},F=r("取消");i();const M=V(((e,t,l,i,b,u)=>{const p=a("el-button"),m=a("el-input"),g=a("el-table-column"),f=a("el-popover"),C=a("el-table"),y=a("el-pagination"),R=a("el-form-item"),M=a("el-form"),U=a("el-dialog");return s(),o("div",w,[d("div",v,[d("div",null,[d("div",z,[d("div",S,[d(p,{size:"small",type:"success",plain:"",onClick:t[1]||(t[1]=e=>u.doAdd())},{default:V((()=>[k])),_:1})]),d("div",null,[d(m,{size:"small",placeholder:"请输入内容",onKeyup:t[3]||(t[3]=n((e=>u.onSearch()),["enter"])),modelValue:b.searchContent,"onUpdate:modelValue":t[4]||(t[4]=e=>b.searchContent=e)},{append:V((()=>[d(p,{size:"small",onClick:t[2]||(t[2]=e=>u.onSearch()),icon:"el-icon-search"})])),_:1},8,["modelValue"])])]),d("div",_,[d(C,{size:"mini","highlight-current-row":"",border:"",data:b.ReLabels,stripe:"","row-style":u.rowStyle,"cell-style":u.cellStyle},{default:V((()=>[d(g,{label:"序号",width:"50px"},{default:V((e=>[r(c(e.$index+1),1)])),_:1}),d(g,{label:"名称",prop:"name"}),d(g,{label:"最后更新时间",prop:"update_at"},{default:V((({row:e})=>[d("span",null,c(u.parseTimeSelf(e.update_at)),1)])),_:1}),d(g,{label:"操作",align:"center",width:"400px"},{default:V((e=>[d("div",x,[d("div",null,[d(p,{size:"mini",type:"primary",onClick:t=>u.doEdit(e),plain:"",disabled:b.editCodeButVisable[e.row.id]},{default:V((()=>[L])),_:2},1032,["onClick","disabled"])]),d("div",null,[d(p,{size:"mini",type:"primary",onClick:t=>u.doEditReLablesCode(e),disabled:b.editCodeButVisable[e.row.id],plain:""},{default:V((()=>[E])),_:2},1032,["onClick","disabled"])]),d("div",null,[d(p,{size:"mini",type:"warning",disabled:b.postCodeButVisable[e.row.id],onClick:t=>u.doPostReLablesCode(e)},{default:V((()=>[$])),_:2},1032,["disabled","onClick"])]),d("div",null,[!0===e.row.enabled?(s(),o(p,{key:0,size:"mini",type:"info",onClick:t=>u.invocate(e),plain:"",disabled:b.editCodeButVisable[e.row.id]},{default:V((()=>[B])),_:2},1032,["onClick","disabled"])):h("",!0),!1===e.row.enabled?(s(),o(p,{key:1,size:"mini",type:"warning",onClick:t=>u.invocate(e),plain:"",disabled:b.editCodeButVisable[e.row.id]},{default:V((()=>[T])),_:2},1032,["onClick","disabled"])):h("",!0)]),d("div",null,[d(f,{visible:b.deleteVisible[e.$index],placement:"top"},{reference:V((()=>[d(p,{size:"mini",type:"danger",plain:"",onClick:t=>u.doDelete(e),disabled:b.editCodeButVisable[e.row.id]},{default:V((()=>[P])),_:2},1032,["onClick","disabled"])])),default:V((()=>[I,d("div",j,[d(p,{size:"mini",type:"text",onClick:t=>u.doNo(e)},{default:V((()=>[G])),_:2},1032,["onClick"]),d(p,{type:"primary",size:"mini",onClick:t=>u.doYes(e)},{default:V((()=>[N])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])])])),_:1})])),_:1},8,["data","row-style","cell-style"]),d("div",D,[d(y,{onSizeChange:u.handleSizeChange,onCurrentChange:u.handleCurrentChange,"current-page":b.currentPage,"page-sizes":[10],"page-size":b.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:b.pageTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])]),d("div",O,[d("textarea",A,null,512)])]),d(U,{title:b.dialogTitle,modelValue:b.dialogVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>b.dialogVisible=e),width:"400px",modal:"","before-close":u.handleClose},{default:V((()=>[d("span",null,[d(M,{"label-position":"right",rules:b.rules,ref:"editRelabelInfo",model:b.editRelabelInfo,"label-width":"90px",size:"small"},{default:V((()=>[d(R,{label:"标签名：",prop:"name"},{default:V((()=>[d(m,{style:{width:"230px"},modelValue:b.editRelabelInfo.name,"onUpdate:modelValue":t[5]||(t[5]=e=>b.editRelabelInfo.name=e)},null,8,["modelValue"])])),_:1}),d(R,{size:"small"},{default:V((()=>[d(p,{size:"small",type:"primary",onClick:t[6]||(t[6]=e=>u.onSubmit("editRelabelInfo"))},{default:V((()=>[r(c(b.buttonTitle),1)])),_:1}),d(p,{size:"small",type:"info",onClick:t[7]||(t[7]=e=>u.onCancel("editRelabelInfo"))},{default:V((()=>[F])),_:1})])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue","before-close"])])}));R.render=M,R.__scopeId="data-v-b0f31f00";export default R;
