var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,n=(e,n)=>{for(var s in n||(n={}))i.call(n,s)&&l(e,s,n[s]);if(t)for(var s of t(n))a.call(n,s)&&l(e,s,n[s]);return e};import{g as s}from"./jobs.2229f8b1.js";import{g as d,p as o,a as h,d as c,e as r,b as p}from"./machines.beccbee0.js";import{p as u}from"./publish.e4ef820f.js";import{p as g,j as m,r as f,o as b,c as y,a as C,q as _,w,F as I,n as V,l as S,t as z,k as j}from"./vendor.684f159e.js";import"./request.c24bac87.js";import"./index.6f2c4da2.js";const M={name:"Manager",components:{},data:()=>({machines:[],jobs:[],jobsMap:{},selectTypeValue:{},search:"",pageSize:15,pageTotal:0,currentPage:1,selectOption:"1",searchContent:"",dialogVisible:!1,deleteVisible:{},enterBtnTitle:"创建",selectTableChanged:{},addMechineInfo:{ipAddr:"",jobId:[]},groupNameList:{},addAndContinueDisabled:!1,dialogTitle:"新增IP地址",rules:{ipAddr:[{required:!0,message:"请输入正确的IP地址",validator:function(e,t,i){if(""===t||void 0===t||null==t)i(new Error("请输入正确的IP地址"));else{/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(t)||""===t?i():i(new Error("请输入正确的IP地址"))}},trigger:"blur"}]},multipleSelection:[],pageshow:!1,pushing:!1,editObj:null}),created(){},mounted(){this.$route.params.currentPage&&(this.currentPage=parseInt(this.$route.params.currentPage)),this.$route.params.pageSize&&(this.pageSize=parseInt(this.$route.params.pageSize)),this.doGetMechines()},methods:{doAdd(){this.enterBtnTitle="创建",this.dialogTitle="新增IP地址",this.dialogVisible=!0,this.addAndContinueDisabled=!1,this.addMechineInfo={}},doGetMechines(e){s().then((t=>{this.jobs=t.data,t.data.forEach((e=>{this.jobsMap[e.id]=e.name})),e||(e={pageNo:this.currentPage,pageSize:this.pageSize,search:this.searchContent,option:this.selectOption}),d(e).then((e=>{this.machines=e.data.data,this.pageTotal=e.data.totalCount,this.currentPage=e.data.pageNo,this.pageSize=e.data.pageSize,this.pageshow=!1,this.$nextTick((()=>{this.pageshow=!0})),this.deleteVisible={};let t=0;e.data.data.forEach((e=>{this.selectTypeValue[e.id]=e.jobs_id,this.deleteVisible[t]=!1,t+=1}))})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},handleSelect(e,t,i){if(e)this.selectTableChanged[i.id]=!1;else if(!1!==this.selectTableChanged[i.id]){var a={};a.id=i.id,a.ipaddr=i.ipaddr,a.jobs_id=this.selectTypeValue[i.id],o(a).then((e=>{this.$notify({title:"成功",message:"更新成功！",type:"success"}),this.selectTableChanged[i.id]=!1,this.selectTypeValue=n({},this.selectTypeValue),this.expandChange(i,i)})).catch((e=>{console.log(e)}))}},tableSelectChange(e,t,i){this.selectTableChanged[i.id]=!0},handleSizeChange(e){let t={pageNo:this.currentPage,pageSize:e,search:this.searchContent,option:this.selectOption};this.doGetMechines(t)},handleCurrentChange(e){let t={pageNo:e,pageSize:this.pageSize,search:this.searchContent,option:this.selectOption};this.doGetMechines(t)},handleClose(e){this.dialogVisible=!1},onSubmitAndContinue(e){this.$refs[e].validate((e=>{if(!e)return!1;{let e={};e.ipaddr=this.addMechineInfo.ipAddr,e.jobs_id=this.addMechineInfo.jobId,h(e).then((e=>{this.$notify({title:"成功",message:"创建成功！",type:"success"}),this.doGetMechines()})).catch((e=>{console.log(e)}))}}))},onSubmit(e){this.$refs[e].validate((t=>{if(!t)return!1;{let t={};t.ipaddr=this.addMechineInfo.ipAddr,t.jobs_id=this.addMechineInfo.jobId,"创建"===this.enterBtnTitle?h(t).then((t=>{this.$notify({title:"成功",message:"创建成功！",type:"success"}),this.doGetMechines(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>console.log(e))):(t.id=this.addMechineInfo.id,o(t).then((t=>{this.$notify({title:"成功",message:"更新成功！",type:"success"}),this.selectTypeValue[this.addMechineInfo.id]=this.addMechineInfo.jobId,this.selectTypeValue=n({},this.selectTypeValue),this.dialogVisible=!1,this.editObj.row.jobs_id=this.addMechineInfo.jobId,this.editObj.row.ipaddr=this.addMechineInfo.ipAddr,this.$refs[e].resetFields(),this.expandChange({id:this.addMechineInfo.id},{id:this.addMechineInfo.id})})).catch((e=>console.log(e))))}}))},onCancel(e){this.dialogVisible=!1,this.$refs[e].resetFields()},onSearch(){this.doGetMechines()},onPublish(){this.pushing=!0,u().then((e=>{this.$notify({title:"成功",message:"发布成功！",type:"success"}),this.pushing=!1})).catch((e=>{console.log(e),this.pushing=!1}))},parseTimeSelf(e){var t=new Date(Date.parse(e));return t.toLocaleDateString()+" "+t.toTimeString().split(" ")[0]},doYes(e){c(e.row.id).then((e=>{this.$notify({title:"成功",message:"删除成功！",type:"success"}),this.doGetMechines()})).catch((e=>{console.log(e)})),this.deleteVisible[e.$index]=!1},doNo(e){this.deleteVisible[e.$index]=!1},doDelete(e){this.deleteVisible[e.$index]=!0},rowStyle:e=>({padding:"0"}),cellStyle:e=>({padding:"0"}),edit(e){this.editObj=e,this.enterBtnTitle="更新",this.dialogTitle="编辑IP地址",this.addAndContinueDisabled=!0,this.dialogVisible=!0,this.addMechineInfo={ipAddr:e.row.ipaddr,id:e.row.id},0!==this.selectTypeValue[e.row.id].length?this.addMechineInfo.jobId=this.selectTypeValue[e.row.id]:this.addMechineInfo.jobId=e.row.jobs_id},expandChange(e,t){if(!t||0===t.length)return;let i=[];this.selectTypeValue[e.id].forEach((e=>{i.push(this.jobsMap[e])})),this.groupNameList[e.id]=i},invocate(e){const t=!this.machines[e.$index].enabled,i={id:e.row.id,enabled:t};r(i).then((i=>{this.$notify({title:"成功",message:"更新状态成功！",type:"success"}),this.machines[e.$index].enabled=t,this.machines=[...this.machines]})).catch((e=>console.log(e)))},doBatchAdd(){const e={currentPage:this.currentPage,pageSize:this.pageSize};this.$router.push({name:"BatchOpt",params:e})},doBatchDel(){if(0===this.multipleSelection.length)return this.$notify({title:"警告",message:"未选中任何项！",type:"warning"}),!1;this.$confirm("是否确定删除？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((e=>{p(this.multipleSelection).then((e=>{this.$notify({title:"成功",message:"删除所选项成功！",type:"success"}),this.doGetMechines()})).catch((e=>console.log(e)))})).catch((e=>console.log(e)))},handleSelectionChange(e){this.multipleSelection=[],e.forEach((e=>{this.multipleSelection.push(e.id)}))}}},k=j();g("data-v-08d62350");const T={class:"ipManager-board"},v={class:"action-btn-area"},x={class:"action-btn-del"},$=S("删除选中项"),P={class:"do_action"},A={style:{"padding-right":"15px"}},O=S("发布【file_sd_configs】"),B=S("发布【file_sd_configs】"),D=S("批量添加"),N=S("添加IP"),E=C("span",{type:"warning"},"状态",-1),G=S("disabled"),U=S("编辑"),F=S("禁用"),L=S("启用"),q=C("p",null,"确定删除吗？",-1),K={style:{"text-align":"right",margin:"0"}},Y=S("取消"),H=S("确定"),J=S("删除"),Q={key:0,class:"block"},R=S("创建并继续"),W=S("取消");m();const X=k(((e,t,i,a,l,n)=>{const s=f("el-button"),d=f("el-option"),o=f("el-select"),h=f("el-input"),c=f("el-table-column"),r=f("el-descriptions-item"),p=f("el-descriptions"),u=f("el-tooltip"),g=f("el-tag"),m=f("el-popover"),j=f("el-table"),M=f("el-pagination"),X=f("el-form-item"),Z=f("el-form"),ee=f("el-dialog");return b(),y("div",T,[C("div",v,[C("div",x,[C(s,{icon:"el-icon-lightning",size:"small",type:"info",plain:"",onClick:t[1]||(t[1]=e=>n.doBatchDel())},{default:k((()=>[$])),_:1})]),C("div",P,[C("div",A,[!1===l.pushing?(b(),y(s,{key:0,size:"small",icon:"el-icon-upload",type:"primary",onClick:t[2]||(t[2]=e=>n.onPublish())},{default:k((()=>[O])),_:1})):_("",!0),!0===l.pushing?(b(),y(s,{key:1,size:"small",icon:"el-icon-loading",type:"primary"},{default:k((()=>[B])),_:1})):_("",!0),C(s,{size:"small",type:"warning",plain:"",onClick:t[3]||(t[3]=e=>n.doBatchAdd())},{default:k((()=>[D])),_:1}),C(s,{size:"small",type:"success",plain:"",onClick:t[4]||(t[4]=e=>n.doAdd())},{default:k((()=>[N])),_:1})]),C("div",null,[C(h,{size:"small",onKeyup:t[7]||(t[7]=w((e=>n.onSearch()),["enter"])),placeholder:"请输入内容",modelValue:l.searchContent,"onUpdate:modelValue":t[8]||(t[8]=e=>l.searchContent=e),class:"input-with-select"},{prepend:k((()=>[C(o,{class:"searchSelect",modelValue:l.selectOption,"onUpdate:modelValue":t[5]||(t[5]=e=>l.selectOption=e),placeholder:"请选择"},{default:k((()=>[C(d,{label:"IP地址",value:"1"}),C(d,{label:"分组",value:"2"})])),_:1},8,["modelValue"])])),append:k((()=>[C(s,{icon:"el-icon-search",onClick:t[6]||(t[6]=e=>n.onSearch())})])),_:1},8,["modelValue"])])])]),C(j,{size:"mini","highlight-current-row":"",border:"",data:l.machines,stripe:"","row-style":n.rowStyle,"cell-style":n.cellStyle,"header-align":"center",onExpandChange:n.expandChange,onSelectionChange:n.handleSelectionChange},{default:k((()=>[C(c,{type:"selection",width:"40"}),C(c,{type:"expand"},{default:k((e=>[C(p,{title:"分组列表",size:"mini",column:4,border:""},{default:k((()=>[(b(!0),y(I,null,V(l.groupNameList[e.row.id],((e,t)=>(b(),y(r,{key:t,label:t+1},{default:k((()=>[S(z(e),1)])),_:2},1032,["label"])))),128))])),_:2},1024)])),_:1}),C(c,{label:"序号",width:"50px",align:"center","header-align":"center"},{default:k((e=>[S(z(e.$index+1),1)])),_:1}),C(c,{label:"IP地址",prop:"ipaddr",align:"center","header-align":"center"}),C(c,{label:"分组选项",prop:"jobs_id",align:"center","header-align":"center"},{default:k((e=>[C(o,{modelValue:l.selectTypeValue[e.row.id],"onUpdate:modelValue":t=>l.selectTypeValue[e.row.id]=t,class:"borderNone","popper-class":"pppselect",onChange:t=>n.tableSelectChange(t,e.$index,e.row),onVisibleChange:t=>n.handleSelect(t,e.$index,e.row),size:"small",multiple:"","collapse-tags":"",placeholder:"请选择"},{default:k((()=>[(b(!0),y(I,null,V(l.jobs,(e=>(b(),y(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","onVisibleChange"])])),_:1}),C(c,{label:"状态",width:"90px",align:"center","header-align":"center"},{header:k((()=>[C(u,{content:"所有机器状态5分钟更新一次",placement:"top"},{default:k((()=>[E])),_:1})])),default:k((({row:e})=>["up"===e.health?(b(),y(u,{key:0,content:"主机正在运行",placement:"top"},{default:k((()=>[C(g,{type:"primary",size:"mini"},{default:k((()=>[S(z(e.health),1)])),_:2},1024)])),_:2},1024)):!1===e.enabled?(b(),y(u,{key:1,content:e.last_error,placement:"top"},{default:k((()=>[!1===e.enabled?(b(),y(g,{key:0,size:"mini",type:"warning"},{default:k((()=>[G])),_:1})):_("",!0)])),_:2},1032,["content"])):(b(),y(u,{key:2,content:e.last_error,placement:"top"},{default:k((()=>["down"===e.health?(b(),y(g,{key:0,size:"mini",type:"danger"},{default:k((()=>[S(z(e.health),1)])),_:2},1024)):(b(),y(g,{key:1,type:"info",size:"mini"},{default:k((()=>[S(z(e.health),1)])),_:2},1024))])),_:2},1032,["content"]))])),_:1}),C(c,{label:"最后更新时间",prop:"update_at",align:"center","header-align":"center"},{default:k((({row:e})=>[C("span",null,z(n.parseTimeSelf(e.update_at)),1)])),_:1}),C(c,{label:"操作",align:"center","header-align":"center",width:"210px"},{default:k((e=>[C(s,{type:"primary",plain:"",size:"mini",onClick:t=>n.edit(e)},{default:k((()=>[U])),_:2},1032,["onClick"]),!0===e.row.enabled?(b(),y(s,{key:0,type:"info",plain:"",size:"mini",onClick:t=>n.invocate(e)},{default:k((()=>[F])),_:2},1032,["onClick"])):_("",!0),!1===e.row.enabled?(b(),y(s,{key:1,type:"warning",plain:"",size:"mini",onClick:t=>n.invocate(e)},{default:k((()=>[L])),_:2},1032,["onClick"])):_("",!0),C(m,{visible:l.deleteVisible[e.$index],placement:"top",width:160},{reference:k((()=>[C(s,{size:"mini",type:"danger",plain:"",onClick:t=>n.doDelete(e)},{default:k((()=>[J])),_:2},1032,["onClick"])])),default:k((()=>[q,C("div",K,[C(s,{size:"mini",type:"text",onClick:t=>n.doNo(e)},{default:k((()=>[Y])),_:2},1032,["onClick"]),C(s,{type:"primary",size:"mini",onClick:t=>n.doYes(e)},{default:k((()=>[H])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])),_:1})])),_:1},8,["data","row-style","cell-style","onExpandChange","onSelectionChange"]),l.pageshow?(b(),y("div",Q,[C(M,{onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange,"current-page":l.currentPage,"page-sizes":[15,50,100,200],"page-size":l.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:l.pageTotal,ref:"pagination"},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])):_("",!0),C(ee,{title:l.dialogTitle,modelValue:l.dialogVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>l.dialogVisible=e),width:"400px",modal:"","before-close":n.handleClose},{default:k((()=>[C("span",null,[C(Z,{"label-position":"right",rules:l.rules,ref:"addMechineInfo",model:l.addMechineInfo,"label-width":"90px",size:"small"},{default:k((()=>[C(X,{label:"IP地址：",prop:"ipAddr"},{default:k((()=>[C(h,{style:{width:"230px"},modelValue:l.addMechineInfo.ipAddr,"onUpdate:modelValue":t[9]||(t[9]=e=>l.addMechineInfo.ipAddr=e),onKeyup:t[10]||(t[10]=w((e=>n.onSubmitAndContinue("addMechineInfo")),["enter"]))},null,8,["modelValue"])])),_:1}),C(X,{label:"分组名：",prop:"jobId"},{default:k((()=>[C(o,{style:{width:"230px"},modelValue:l.addMechineInfo.jobId,"onUpdate:modelValue":t[11]||(t[11]=e=>l.addMechineInfo.jobId=e),placeholder:"请选择","collapse-tags":"",multiple:""},{default:k((()=>[(b(!0),y(I,null,V(l.jobs,((e,t)=>(b(),y(d,{key:t,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(X,{size:"small"},{default:k((()=>[C(s,{size:"small",type:"primary",disabled:l.addAndContinueDisabled,onClick:t[12]||(t[12]=e=>n.onSubmitAndContinue("addMechineInfo"))},{default:k((()=>[R])),_:1},8,["disabled"]),C(s,{size:"small",type:"primary",onClick:t[13]||(t[13]=e=>n.onSubmit("addMechineInfo"))},{default:k((()=>[S(z(l.enterBtnTitle),1)])),_:1}),C(s,{size:"small",type:"info",onClick:t[14]||(t[14]=e=>n.onCancel("addMechineInfo"))},{default:k((()=>[W])),_:1})])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue","before-close"])])}));M.render=X,M.__scopeId="data-v-08d62350";export default M;
