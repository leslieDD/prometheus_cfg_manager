import{s as e}from"./request.10a66ff0.js";import{p as t,j as l,r as a,o,c as s,a as n,F as i,n as r,w as d,l as h,t as p,q as g,k as c}from"./vendor.02dbbba7.js";import"./index.24626b86.js";const u={name:"Log",data:()=>({systemLogs:[],paginationShow:!0,pageSize:25,pageTotal:0,currentPage:1,searchContent:"",runningMod:!1,levelPool:[],allLevelPool:[],selectChanged:!1}),mounted(){this.dogetSystemReocdeSetting(),this.doGetSystemLog()},methods:{doSearch(){this.doGetSystemLog()},doGetSystemLog(t){var l;t||(t={pageNo:this.currentPage,pageSize:this.pageSize,search:this.searchContent}),(l=t,e({url:"/v1/system/log",method:"get",params:l})).then((e=>{this.systemLogs=e.data.data,this.pageTotal=e.data.totalCount,this.currentPage=e.data.pageNo,this.pageSize=e.data.pageSize,this.paginationShow=!1,this.$nextTick((()=>{this.paginationShow=!0}))})).catch((e=>console.log(e)))},doClearSystem(){this.runningMod=!0,e({url:"/v1/system/log/clear",method:"post"}).then((e=>{this.$notify({title:"成功",message:"清理成功！",type:"success"}),this.runningMod=!1,this.doGetSystemLog()})).catch((e=>{console.log(e),this.runningMod=!1}))},dogetSystemReocdeSetting(){e({url:"/v1/system/log/setting",method:"get"}).then((e=>{let t=[];e.data.forEach((e=>{e.selected&&t.push(e.id)})),this.levelPool=t,this.allLevelPool=e.data}))},doPutRecodeSetting(t){var l;this.selectChanged&&(t||(l=this.levelPool,e({url:"/v1/system/log/setting",method:"put",data:l})).then((e=>{this.selectChanged=!1,this.$notify({title:"成功",message:"更新成功！",type:"success"})})))},selectChange(){this.selectChanged=!0},handleSizeChange(e){let t={pageNo:this.currentPage,pageSize:e,search:this.searchContent};this.doGetSystemLog(t)},handleCurrentChange(e){let t={pageNo:e,pageSize:this.pageSize,search:this.searchContent};this.doGetSystemLog(t)},rowStyle:e=>({padding:"0"}),cellStyle:e=>({padding:"0"}),parseTimeSelf(e){var t=new Date(Date.parse(e));return t.toLocaleDateString()+" "+t.toTimeString().split(" ")[0]}}},m=c();t("data-v-afd3c818");const S=n("i",{class:"el-icon-user"},null,-1),y=h(" 要记录的日志类型 "),C=n("i",{class:"el-icon-user"},null,-1),b=h(" 请空所有日志 "),v=h("请空所有日志"),f=n("i",{class:"el-icon-mobile-phone"},null,-1),w=h(" 搜索 "),z={key:0,class:"block"};l();const _=m(((e,t,l,c,u,_)=>{const P=a("el-option"),L=a("el-select"),x=a("el-descriptions-item"),V=a("el-button"),k=a("el-input"),T=a("el-descriptions"),G=a("el-table-column"),j=a("el-table"),M=a("el-pagination"),R=a("el-scrollbar");return o(),s("div",null,[n(T,{class:"margin-top",column:3,size:"small",border:""},{default:m((()=>[n(x,null,{label:m((()=>[S,y])),default:m((()=>[n(L,{size:"small",modelValue:u.levelPool,"onUpdate:modelValue":t[1]||(t[1]=e=>u.levelPool=e),clearable:"",placeholder:"请选择",multiple:"","collapse-tags":"",onVisibleChange:_.doPutRecodeSetting,onClear:_.doPutRecodeSetting,onChange:_.selectChange},{default:m((()=>[(o(!0),s(i,null,r(u.allLevelPool,(e=>(o(),s(P,{key:e.id,label:e.label,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onVisibleChange","onClear","onChange"])])),_:1}),n(x,null,{label:m((()=>[C,b])),default:m((()=>[n(V,{size:"small",disabled:u.runningMod,type:"danger",onClick:_.doClearSystem},{default:m((()=>[v])),_:1},8,["disabled","onClick"])])),_:1}),n(x,null,{label:m((()=>[f,w])),default:m((()=>[n(k,{placeholder:"请输入查询内容，回车执行搜索",size:"small",onKeyup:d(_.doSearch,["enter"]),modelValue:u.searchContent,"onUpdate:modelValue":t[2]||(t[2]=e=>u.searchContent=e)},null,8,["onKeyup","modelValue"])])),_:1})])),_:1}),n(R,{height:"75vh",class:"flex-content"},{default:m((()=>[n(j,{size:"mini","highlight-current-row":"",border:"",data:u.systemLogs,stripe:"","row-style":_.rowStyle,"cell-style":_.cellStyle},{default:m((()=>[n(G,{label:"序号",width:"50px"},{default:m((e=>[h(p(e.$index+1),1)])),_:1}),n(G,{label:"用户名",width:"100px",prop:"username"}),n(G,{label:"IP地址",width:"150px",prop:"ipaddr"}),n(G,{label:"类型",width:"80px",prop:"operate_type"}),n(G,{label:"操作内容","show-overflow-tooltip":"",width:"230px",prop:"operate_content"}),n(G,{label:"结果",width:"50px",prop:"operate_result"}),n(G,{label:"操作时间",width:"130px",prop:"operate_at"},{default:m((({row:e})=>[n("span",null,p(_.parseTimeSelf(e.operate_at)),1)])),_:1}),n(G,{label:"错误原因","show-overflow-tooltip":"",prop:"operate_error"})])),_:1},8,["data","row-style","cell-style"]),u.paginationShow?(o(),s("div",z,[n(M,{onSizeChange:_.handleSizeChange,onCurrentChange:_.handleCurrentChange,"current-page":u.currentPage,"page-sizes":[25,50,80,100],"page-size":u.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:u.pageTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])):g("",!0)])),_:1})])}));u.render=_,u.__scopeId="data-v-afd3c818";export default u;
