import{s as e}from"./request.0c690da8.js";import{c as t}from"./jobs.75f86484.js";import{g as l}from"./relabel.902192cc.js";import{r as a}from"./srv.929685a5.js";import{p as i,b as o,r as s,o as d,c as n,a as r,h as p,j as h,t as c,k as u,F as b,i as g,w as m}from"./vendor.61ee7ef1.js";const f={name:"JobsDefault",data:()=>({jobs:[],addJobInfo:{name:"",port:0,display_order:1,relabel_id:0},relabelList:[],pageSize:15,pageTotal:0,currentPage:1,searchContent:"",deleteVisible:{},dialogVisible:!1,buttonTitle:"",dialogTitle:"",rules:{name:[{required:!0,message:"请输入正确的分组名称",validator:function(e,t,l){if(""===t||void 0===t||null==t)l(new Error("请输入正确名称"));else{/\s+/.test(t)?l(new Error("名称中不允许有空字符")):l()}},trigger:["blur"]}],port:[{required:!0,type:"number",min:0,max:65535,message:"请输入端口号[>=0, <=65535]",trigger:["change"]}],relabel_id:[{required:!0,type:"number",min:1,message:"请选择重写标签",trigger:["change"]}]}}),created(){},mounted(){this.doGetJobs()},methods:{doAdd(){l().then((e=>{this.relabelList=e.data,this.addJobInfo={name:"",port:0,display_order:1},this.buttonTitle="创建",this.dialogTitle="增加IP分组",this.dialogVisible=!0})).catch((e=>{console.log(e)}))},doGetJobs(t){var l;t||(t={pageNo:this.currentPage,pageSize:this.pageSize,search:this.searchContent}),(l=t,e({url:"/v1/jobs/default/split",method:"get",params:l})).then((e=>{let t=0;e.data.data.forEach((e=>{this.deleteVisible[t]=!1,t+=1})),this.jobs=e.data.data,this.pageTotal=e.data.totalCount,this.currentPage=e.data.pageNo,this.pageSize=e.data.pageSize})).catch((e=>{console.log(e)}))},doEdit(e){l().then((t=>{this.relabelList=t.data,this.buttonTitle="更新",this.dialogTitle="编辑IP分组",this.addJobInfo.id=e.row.id,this.addJobInfo.name=e.row.name,this.addJobInfo.port=e.row.port,this.addJobInfo.relabel_id=e.row.relabel_id,this.addJobInfo.relabel_name=e.row.relabel_name,this.dialogVisible=!0})).catch((e=>{console.log(e)}))},handleSizeChange(e){let t={pageNo:this.currentPage,pageSize:e,search:this.searchContent};this.doGetJobs(t)},handleCurrentChange(e){let t={pageNo:e,pageSize:this.pageSize,search:this.searchContent};this.doGetJobs(t)},handleClose(e){this.dialogVisible=!1},onSubmit(t){this.$refs[t].validate((l=>{if(!l)return!1;{let l={};l.name=this.addJobInfo.name,l.port=this.addJobInfo.port,l.display_order=this.addJobInfo.display_order,l.relabel_id=this.addJobInfo.relabel_id,"创建"===this.buttonTitle?(a=l,e({url:"/v1/job/default",method:"post",data:a})).then((e=>{this.$notify({title:"成功",message:"创建成功！",type:"success"}),this.doGetJobs(),this.dialogVisible=!1,this.$refs[t].resetFields()})).catch((e=>{console.log(e)})):(l.id=this.addJobInfo.id,function(t){return e({url:"/v1/job/default",method:"put",data:t})}(l).then((e=>{this.$notify({title:"成功",message:"更新成功！",type:"success"}),this.doGetJobs(),this.dialogVisible=!1,this.$refs[t].resetFields()})).catch((e=>{console.log(e)})))}var a}))},onCancel(e){this.dialogVisible=!1,this.$refs[e].resetFields()},onSearch(){this.doGetJobs()},parseTimeSelf(e){var t=new Date(Date.parse(e));return t.toLocaleDateString()+" "+t.toTimeString().split(" ")[0]},doYes(t){var l;(l=t.row.id,e({url:"/v1/job/default",method:"delete",params:{id:l}})).then((e=>{this.$notify({title:"成功",message:"删除成功！",type:"success"}),this.doGetJobs()})).catch((e=>{console.log(e)})),this.deleteVisible[t.$index]=!1},doNo(e){this.deleteVisible[e.$index]=!1},doDelete(e){this.deleteVisible[e.$index]=!0},rowStyle:e=>({padding:"0"}),cellStyle:e=>({padding:"0"}),doUp(e){return 0===this.jobs.length?(this.$notify({title:"错误",message:"没有有效的数据！",type:"error"}),!1):1===e.row.display_order?(this.$notify({title:"警告",message:"已经是顶层！",type:"warning"}),!1):void this.swapAction({id:e.row.id,action:"up",display_order:e.row.display_order})},doDown(e){if(0===this.jobs.length)return this.$notify({title:"错误",message:"没有有效的数据！",type:"error"}),!1;return this.jobs[this.jobs.length-1].id===e.row.id&&this.jobs.length!==this.pageSize||this.currentPage*this.pageSize===this.pageTotal?(this.$notify({title:"警告",message:"已经是底层！",type:"warning"}),!1):void this.swapAction({id:e.row.id,action:"down",display_order:e.row.display_order})},swapAction(e){swapJob(e).then((t=>{"up"===e.action?this.$notify({title:"成功",message:"提升成功！",type:"success"}):this.$notify({title:"成功",message:"下降成功！",type:"success"}),this.doGetJobs()})).catch((e=>{console.log(e)}))},publishJobsfunc(){t().then((e=>{this.$notify({title:"成功",message:"发布成功！",type:"success"})})).catch((e=>{console.log(e)}))},restartServer(){a().then((e=>{this.$notify({title:"成功",message:"重新加载成功！",type:"success"})})).catch((e=>{console.log(e)}))},invocate(t){const l=!this.jobs[t.$index].enabled,a={id:t.row.id,enabled:l};var i;(i=a,e({url:"/v1/job/default/status",method:"put",data:i})).then((e=>{this.$notify({title:"成功",message:"更新状态成功！",type:"success"}),this.jobs[t.$index].enabled=l,this.jobs=[...this.jobs]})).catch((e=>console.log(e)))}}},y=m();i("data-v-2b069d6e");const _={class:"main-board"},w={class:"do_action"},v={style:{"padding-right":"15px"}},C=h("重新加载配置（Reload）"),z=h("发布"),J=h("添加"),S={class:"actioneara"},V=h("编辑"),I=h("禁用"),j=h("启用"),k=r("p",null,"确定删除吗？",-1),$={style:{"text-align":"right",margin:"0"}},x=h("取消"),T=h("确定"),G=h("删除"),P={class:"block"},D=h("取消");o();const N=y(((e,t,l,a,i,o)=>{const m=s("el-button"),f=s("el-input"),N=s("el-table-column"),U=s("el-popover"),A=s("el-table"),E=s("el-pagination"),L=s("el-form-item"),q=s("el-option"),F=s("el-select"),Y=s("el-form"),K=s("el-dialog");return d(),n("div",_,[r("div",w,[r("div",v,[r(m,{size:"small",type:"warning",onClick:t[1]||(t[1]=e=>o.restartServer())},{default:y((()=>[C])),_:1}),r(m,{size:"small",type:"primary",onClick:t[2]||(t[2]=e=>o.publishJobsfunc())},{default:y((()=>[z])),_:1}),r(m,{size:"small",type:"success",plain:"",onClick:t[3]||(t[3]=e=>o.doAdd())},{default:y((()=>[J])),_:1})]),r("div",null,[r("div",null,[r(f,{size:"small",placeholder:"请输入内容",onKeyup:t[5]||(t[5]=p((e=>o.onSearch()),["enter"])),modelValue:i.searchContent,"onUpdate:modelValue":t[6]||(t[6]=e=>i.searchContent=e)},{append:y((()=>[r(m,{size:"small",onClick:t[4]||(t[4]=e=>o.onSearch()),icon:"el-icon-search"})])),_:1},8,["modelValue"])])])]),r(A,{size:"mini","highlight-current-row":"",border:"",data:i.jobs,stripe:"","row-style":o.rowStyle,"cell-style":o.cellStyle},{default:y((()=>[r(N,{label:"序号",width:"50px"},{default:y((e=>[h(c(e.$index+1),1)])),_:1}),r(N,{label:"分组名称",prop:"name"}),r(N,{label:"端口号",width:"90px",prop:"port"}),r(N,{label:"IP数",width:"80px",prop:"count"}),r(N,{label:"重写标签",prop:"relabel_name"}),r(N,{label:"最后更新时间",prop:"update_at"},{default:y((({row:e})=>[r("span",null,c(o.parseTimeSelf(e.update_at)),1)])),_:1}),r(N,{label:"操作",align:"center",width:"200px"},{default:y((e=>[r("div",S,[r("div",null,[r(m,{size:"mini",type:"primary",onClick:t=>o.doEdit(e),plain:""},{default:y((()=>[V])),_:2},1032,["onClick"])]),r("div",null,[!0===e.row.enabled?(d(),n(m,{key:0,size:"mini",type:"info",onClick:t=>o.invocate(e),plain:""},{default:y((()=>[I])),_:2},1032,["onClick"])):u("",!0),!1===e.row.enabled?(d(),n(m,{key:1,size:"mini",type:"warning",onClick:t=>o.invocate(e),plain:""},{default:y((()=>[j])),_:2},1032,["onClick"])):u("",!0)]),r("div",null,[r(U,{visible:i.deleteVisible[e.$index],placement:"top"},{reference:y((()=>[r(m,{size:"mini",type:"danger",plain:"",onClick:t=>o.doDelete(e)},{default:y((()=>[G])),_:2},1032,["onClick"])])),default:y((()=>[k,r("div",$,[r(m,{size:"mini",type:"text",onClick:t=>o.doNo(e)},{default:y((()=>[x])),_:2},1032,["onClick"]),r(m,{type:"primary",size:"mini",onClick:t=>o.doYes(e)},{default:y((()=>[T])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])])])),_:1})])),_:1},8,["data","row-style","cell-style"]),r("div",P,[r(E,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":i.currentPage,"page-sizes":[10,15,30,50],"page-size":i.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:i.pageTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),r(K,{title:i.dialogTitle,modelValue:i.dialogVisible,"onUpdate:modelValue":t[12]||(t[12]=e=>i.dialogVisible=e),width:"400px",modal:"","before-close":o.handleClose},{default:y((()=>[r("span",null,[r(Y,{"label-position":"right",rules:i.rules,ref:"addJobInfo",model:i.addJobInfo,"label-width":"90px",size:"small"},{default:y((()=>[r(L,{label:"分组名：",prop:"name"},{default:y((()=>[r(f,{style:{width:"230px"},modelValue:i.addJobInfo.name,"onUpdate:modelValue":t[7]||(t[7]=e=>i.addJobInfo.name=e)},null,8,["modelValue"])])),_:1}),r(L,{label:"端口号",prop:"port"},{default:y((()=>[r(f,{type:"number",style:{width:"230px"},modelValue:i.addJobInfo.port,"onUpdate:modelValue":t[8]||(t[8]=e=>i.addJobInfo.port=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1}),r(L,{label:"重写标签",prop:"relabel_id"},{default:y((()=>[r(F,{modelValue:i.addJobInfo.relabel_id,"onUpdate:modelValue":t[9]||(t[9]=e=>i.addJobInfo.relabel_id=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择",style:{width:"230px"}},{default:y((()=>[(d(!0),n(b,null,g(i.relabelList,(e=>(d(),n(q,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(L,{size:"small"},{default:y((()=>[r(m,{size:"small",type:"primary",onClick:t[10]||(t[10]=e=>o.onSubmit("addJobInfo"))},{default:y((()=>[h(c(i.buttonTitle),1)])),_:1}),r(m,{size:"small",type:"info",onClick:t[11]||(t[11]=e=>o.onCancel("addJobInfo"))},{default:y((()=>[D])),_:1})])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue","before-close"])])}));f.render=N,f.__scopeId="data-v-2b069d6e";export default f;
