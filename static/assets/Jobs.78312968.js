var e=Object.defineProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,l,i)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i;import{a as o,p as s,b as n,d,s as r,c as p,e as c}from"./jobs.75f86484.js";import{g as h}from"./relabel.902192cc.js";import{r as b}from"./srv.929685a5.js";import{g as u}from"./labelsJob.cd5c3520.js";import{p as g,b as m,r as f,o as y,c as _,a as w,h as C,F as z,i as J,j as v,t as I,k as x,w as S}from"./vendor.61ee7ef1.js";import"./request.0c690da8.js";const j={name:"Jobs",data:()=>({jobs:[],addJobInfo:{name:"",port:0,display_order:1,relabel_id:0},relabelList:[],pageSize:15,pageTotal:0,currentPage:1,searchContent:"",deleteVisible:{},dialogVisible:!1,buttonTitle:"",dialogTitle:"",jobAllIPList:{},rules:{name:[{required:!0,message:"请输入正确的分组名称",validator:function(e,t,l){if(""===t||void 0===t||null==t)l(new Error("请输入正确名称"));else{/\s+/.test(t)?l(new Error("名称中不允许有空字符")):l()}},trigger:["blur"]}],port:[{required:!0,type:"number",min:0,max:65535,message:"请输入端口号[>=0, <=65535]",trigger:["change"]}],relabel_id:[{required:!0,type:"number",min:1,message:"请选择重写标签",trigger:["change"]}]}}),created(){},mounted(){this.doGetJobs()},methods:{doAdd(){h().then((e=>{this.relabelList=e.data,this.addJobInfo={name:"",port:0,display_order:1},this.buttonTitle="创建",this.dialogTitle="增加IP分组",this.dialogVisible=!0})).catch((e=>{console.log(e)}))},doEditLabelsJob(e){const o=((e,o)=>{for(var s in o||(o={}))l.call(o,s)&&a(e,s,o[s]);if(t)for(var s of t(o))i.call(o,s)&&a(e,s,o[s]);return e})({},e.row);this.$router.push({name:"labelsJobs",params:o})},doGetJobs(e){e||(e={pageNo:this.currentPage,pageSize:this.pageSize,search:this.searchContent}),o(e).then((e=>{let t=0;e.data.data.forEach((e=>{this.deleteVisible[t]=!1,t+=1})),this.jobs=e.data.data,this.pageTotal=e.data.totalCount,this.currentPage=e.data.pageNo,this.pageSize=e.data.pageSize})).catch((e=>{console.log(e)}))},doEdit(e){h().then((t=>{this.relabelList=t.data,this.buttonTitle="更新",this.dialogTitle="编辑IP分组",this.addJobInfo.id=e.row.id,this.addJobInfo.name=e.row.name,this.addJobInfo.port=e.row.port,this.addJobInfo.relabel_id=e.row.relabel_id,this.addJobInfo.relabel_name=e.row.relabel_name,this.dialogVisible=!0})).catch((e=>{console.log(e)}))},handleSizeChange(e){let t={pageNo:this.currentPage,pageSize:e,search:this.searchContent};this.doGetJobs(t)},handleCurrentChange(e){let t={pageNo:e,pageSize:this.pageSize,search:this.searchContent};this.doGetJobs(t)},handleClose(e){this.dialogVisible=!1},onSubmit(e){this.$refs[e].validate((t=>{if(!t)return!1;{let t={};t.name=this.addJobInfo.name,t.port=this.addJobInfo.port,t.display_order=this.addJobInfo.display_order,t.relabel_id=this.addJobInfo.relabel_id,"创建"===this.buttonTitle?s(t).then((t=>{this.$notify({title:"成功",message:"创建成功！",type:"success"}),this.doGetJobs(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>{console.log(e)})):(t.id=this.addJobInfo.id,n(t).then((t=>{this.$notify({title:"成功",message:"更新成功！",type:"success"}),this.doGetJobs(),this.dialogVisible=!1,this.$refs[e].resetFields()})).catch((e=>{console.log(e)})))}}))},onCancel(e){this.dialogVisible=!1,this.$refs[e].resetFields()},onSearch(){this.doGetJobs()},parseTimeSelf(e){var t=new Date(Date.parse(e));return t.toLocaleDateString()+" "+t.toTimeString().split(" ")[0]},doYes(e){d(e.row.id).then((e=>{this.$notify({title:"成功",message:"删除成功！",type:"success"}),this.doGetJobs()})).catch((e=>{console.log(e)})),this.deleteVisible[e.$index]=!1},doNo(e){this.deleteVisible[e.$index]=!1},doDelete(e){this.deleteVisible[e.$index]=!0},rowStyle:e=>({padding:"0"}),cellStyle:e=>({padding:"0"}),doUp(e){return 0===this.jobs.length?(this.$notify({title:"错误",message:"没有有效的数据！",type:"error"}),!1):1===e.row.display_order?(this.$notify({title:"警告",message:"已经是顶层！",type:"warning"}),!1):void this.swapAction({id:e.row.id,action:"up",display_order:e.row.display_order})},doDown(e){if(0===this.jobs.length)return this.$notify({title:"错误",message:"没有有效的数据！",type:"error"}),!1;return this.jobs[this.jobs.length-1].id===e.row.id&&this.jobs.length!==this.pageSize||this.currentPage*this.pageSize===this.pageTotal?(this.$notify({title:"警告",message:"已经是底层！",type:"warning"}),!1):void this.swapAction({id:e.row.id,action:"down",display_order:e.row.display_order})},swapAction(e){r(e).then((t=>{"up"===e.action?this.$notify({title:"成功",message:"提升成功！",type:"success"}):this.$notify({title:"成功",message:"下降成功！",type:"success"}),this.doGetJobs()})).catch((e=>{console.log(e)}))},publishJobsfunc(){p().then((e=>{this.$notify({title:"成功",message:"发布成功！",type:"success"})})).catch((e=>{console.log(e)}))},restartServer(){b().then((e=>{this.$notify({title:"成功",message:"重新加载成功！",type:"success"})})).catch((e=>{console.log(e)}))},expandChange(e,t){t&&0!==t.length&&(this.jobAllIPList[e.id]||u(e.id).then((t=>{this.jobAllIPList[e.id]=t.data})).catch((e=>console.log(e))))},invocate(e){const t=!this.jobs[e.$index].enabled,l={id:e.row.id,enabled:t};c(l).then((l=>{this.$notify({title:"成功",message:"更新状态成功！",type:"success"}),this.jobs[e.$index].enabled=t,this.jobs=[...this.jobs]})).catch((e=>console.log(e)))}}},k=S();g("data-v-5893b85c");const V={class:"jobs-board"},$={class:"do_action"},P={style:{"padding-right":"15px"}},T=v("重新加载配置（Reload）"),L=v("发布"),E=v("添加"),A={class:"change_order_button"},G={class:"actioneara"},D=v("编辑"),U=v("禁用"),N=v("启用"),O=w("p",null,"确定删除吗？",-1),q={style:{"text-align":"right",margin:"0"}},F=v("取消"),Y=v("确定"),K=v("删除"),M={class:"block"},R=v("取消");m();const B=k(((e,t,l,i,a,o)=>{const s=f("el-button"),n=f("el-input"),d=f("el-descriptions-item"),r=f("el-descriptions"),p=f("el-table-column"),c=f("el-popover"),h=f("el-table"),b=f("el-pagination"),u=f("el-form-item"),g=f("el-option"),m=f("el-select"),S=f("el-form"),j=f("el-dialog");return y(),_("div",V,[w("div",$,[w("div",P,[w(s,{size:"small",type:"warning",onClick:t[1]||(t[1]=e=>o.restartServer())},{default:k((()=>[T])),_:1}),w(s,{size:"small",type:"primary",onClick:t[2]||(t[2]=e=>o.publishJobsfunc())},{default:k((()=>[L])),_:1}),w(s,{size:"small",type:"success",plain:"",onClick:t[3]||(t[3]=e=>o.doAdd())},{default:k((()=>[E])),_:1})]),w("div",null,[w("div",null,[w(n,{size:"small",placeholder:"请输入内容",onKeyup:t[5]||(t[5]=C((e=>o.onSearch()),["enter"])),modelValue:a.searchContent,"onUpdate:modelValue":t[6]||(t[6]=e=>a.searchContent=e)},{append:k((()=>[w(s,{size:"small",onClick:t[4]||(t[4]=e=>o.onSearch()),icon:"el-icon-search"})])),_:1},8,["modelValue"])])])]),w(h,{size:"mini","highlight-current-row":"",border:"",data:a.jobs,stripe:"","row-style":o.rowStyle,"cell-style":o.cellStyle,onExpandChange:o.expandChange},{default:k((()=>[w(p,{type:"expand"},{default:k((e=>[w(r,{title:"IP列表",size:"mini",column:4,border:""},{default:k((()=>[(y(!0),_(z,null,J(a.jobAllIPList[e.row.id],((e,t)=>(y(),_(d,{key:t,label:t+1},{default:k((()=>[v(I(e.ipaddr),1)])),_:2},1032,["label"])))),128))])),_:2},1024)])),_:1}),w(p,{label:"序号",width:"50px"},{default:k((e=>[v(I(e.$index+1),1)])),_:1}),w(p,{label:"分组名称",prop:"name"}),w(p,{label:"端口号",width:"70px",prop:"port"}),w(p,{label:"IP数",width:"60px"},{default:k((e=>[w(s,{size:"mini",type:"text",onClick:t=>o.doEditLabelsJob(e)},{default:k((()=>[v(I(e.row.count),1)])),_:2},1032,["onClick"])])),_:1}),w(p,{label:"重写标签",prop:"relabel_name"}),w(p,{label:"排序号",width:"60px",prop:"display_order"}),w(p,{label:"调整排序号",width:"90px"},{default:k((e=>[w("div",A,[w(s,{size:"mini",type:"primary",icon:"el-icon-top",onClick:t=>o.doUp(e),plain:""},null,8,["onClick"]),w(s,{size:"mini",type:"primary",icon:"el-icon-bottom",onClick:t=>o.doDown(e),plain:""},null,8,["onClick"])])])),_:1}),w(p,{label:"最后更新时间",prop:"update_at",width:"140px"},{default:k((({row:e})=>[w("span",null,I(o.parseTimeSelf(e.update_at)),1)])),_:1}),w(p,{label:"操作",align:"center",width:"200px"},{default:k((e=>[w("div",G,[w("div",null,[w(s,{size:"mini",type:"primary",onClick:t=>o.doEdit(e),plain:""},{default:k((()=>[D])),_:2},1032,["onClick"])]),w("div",null,[!0===e.row.enabled?(y(),_(s,{key:0,size:"mini",type:"info",onClick:t=>o.invocate(e),plain:""},{default:k((()=>[U])),_:2},1032,["onClick"])):x("",!0),!1===e.row.enabled?(y(),_(s,{key:1,size:"mini",type:"warning",onClick:t=>o.invocate(e),plain:""},{default:k((()=>[N])),_:2},1032,["onClick"])):x("",!0)]),w("div",null,[w(c,{visible:a.deleteVisible[e.$index],placement:"top"},{reference:k((()=>[w(s,{size:"mini",type:"danger",plain:"",onClick:t=>o.doDelete(e)},{default:k((()=>[K])),_:2},1032,["onClick"])])),default:k((()=>[O,w("div",q,[w(s,{size:"mini",type:"text",onClick:t=>o.doNo(e)},{default:k((()=>[F])),_:2},1032,["onClick"]),w(s,{type:"primary",size:"mini",onClick:t=>o.doYes(e)},{default:k((()=>[Y])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])])])),_:1})])),_:1},8,["data","row-style","cell-style","onExpandChange"]),w("div",M,[w(b,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":a.currentPage,"page-sizes":[10,15,30,50],"page-size":a.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:a.pageTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),w(j,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":t[12]||(t[12]=e=>a.dialogVisible=e),width:"400px",modal:"","before-close":o.handleClose},{default:k((()=>[w("span",null,[w(S,{"label-position":"right",rules:a.rules,ref:"addJobInfo",model:a.addJobInfo,"label-width":"90px",size:"small"},{default:k((()=>[w(u,{label:"分组名：",prop:"name"},{default:k((()=>[w(n,{style:{width:"230px"},modelValue:a.addJobInfo.name,"onUpdate:modelValue":t[7]||(t[7]=e=>a.addJobInfo.name=e)},null,8,["modelValue"])])),_:1}),w(u,{label:"端口号",prop:"port"},{default:k((()=>[w(n,{type:"number",style:{width:"230px"},modelValue:a.addJobInfo.port,"onUpdate:modelValue":t[8]||(t[8]=e=>a.addJobInfo.port=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1}),w(u,{label:"重写标签",prop:"relabel_id"},{default:k((()=>[w(m,{modelValue:a.addJobInfo.relabel_id,"onUpdate:modelValue":t[9]||(t[9]=e=>a.addJobInfo.relabel_id=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择",style:{width:"230px"}},{default:k((()=>[(y(!0),_(z,null,J(a.relabelList,(e=>(y(),_(g,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(u,{size:"small"},{default:k((()=>[w(s,{size:"small",type:"primary",onClick:t[10]||(t[10]=e=>o.onSubmit("addJobInfo"))},{default:k((()=>[v(I(a.buttonTitle),1)])),_:1}),w(s,{size:"small",type:"info",onClick:t[11]||(t[11]=e=>o.onCancel("addJobInfo"))},{default:k((()=>[R])),_:1})])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["title","modelValue","before-close"])])}));j.render=B,j.__scopeId="data-v-5893b85c";export default j;
