var e=Object.defineProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,s=(e,s)=>{for(var i in s||(s={}))l.call(s,i)&&n(e,i,s[i]);if(t)for(var i of t(s))a.call(s,i)&&n(e,i,s[i]);return e};import{g as i,a as o,p as d,b as u,d as r,c,r as m,e as h,u as p,f}from"./monitor.f7261b60.js";import{p as b,b as y,r as D,o as v,c as x,a as g,F as k,i as _,w,j as C,h as M,k as V,n as F,v as R,q as E,t as $}from"./vendor.61ee7ef1.js";import"./request.0c690da8.js";const z={props:{query:{type:Object,default:null}},components:{},data:()=>({formData:{alert:"",expr:"",for:"",labels:[],annotations:[],enabled:!1},defaultLabels:[],submitType:"",formDisabled:!0,switchValue:!1}),methods:{doGetRuleDetail(e){return!!e&&("[must rename me]"!==e.label&&void i().then((t=>{this.defaultLabels=t.data,o(e).then((e=>{this.formData=e.data,this.submitType="put"})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})))},onSubmit(){const e=this.formData.valueOf();"put"===this.submitType?d(e).then((t=>{this.formData=t.data,this.$emit("fatherMethod",e,"put"),this.$notify({title:"成功",message:"更新成功！",type:"success"})})).catch((e=>{console.log(e)})):"post"===this.submitType?u(e).then((t=>{this.formData=t.data,this.$emit("fatherMethod",e,"post"),this.$notify({title:"成功",message:"创建成功！",type:"success"})})).catch((e=>{console.log(e)})):this.$notify({title:"失败",message:"不支持的操作！",type:"error"})},addLables(e,t){i().then((e=>{this.defaultLabels=e.data;let l=0;"annotations"===t?(0!==this.formData.annotations.length&&(l=this.formData.annotations[this.formData.annotations.length-1].id+1),this.formData.annotations.push({id:l,key:"",value:"",is_new:!0})):"labels"===t&&(0!==this.formData.annotations.length&&(l=this.formData.labels[this.formData.labels.length-1].id+1),this.formData.labels.push({id:l,key:"",value:"",is_new:!0})),this.formData=s({},this.formData)})).catch((e=>{console.log(e)}))},delItem(e,t){const l=e.valueOf();if(l.is_new){if("labels"===t){const t=this.formData.labels.findIndex((t=>t.id===e.id));this.formData.labels.splice(t,1)}else if("annotations"===t){const t=this.formData.annotations.findIndex((t=>t.id===e.id));this.formData.annotations.splice(t,1)}this.formData=s({},this.formData)}else r(l,{type:t}).then((l=>{if(this.$notify({title:"成功",message:"删除成功！",type:"success"}),"labels"===t){const t=this.formData.labels.findIndex((t=>t.id===e.id));this.formData.labels.splice(t,1)}else if("annotations"===t){const t=this.formData.annotations.findIndex((t=>t.id===e.id));this.formData.annotations.splice(t,1)}this.formData=s({},this.formData)})).catch((e=>{console.log(e)}))},setFormDisable(){this.formDisabled=!0},setFormEnable(){this.formDisabled=!1},resetForm(){this.formData={},this.$refs.formRef.resetFields()}}},L=w();b("data-v-0fdb36af");const I={class:"box-member"},S=g("span",null,"告警名称(alert)：",-1),q=g("i",{class:"el-icon-question"},null,-1),U=g("span",null,"表达式(expr)：",-1),N=g("i",{class:"el-icon-question"},null,-1),O=g("span",null,"等待时间(for)：",-1),P=g("i",{class:"el-icon-question"},null,-1),T=g("span",null,"标签(labels)：",-1),j=g("i",{class:"el-icon-question"},null,-1),A={style:{"text-align":"right","padding-right":"14px"}},G=C("增加"),B=g("span",null,"注释(annotations)：",-1),K=g("i",{class:"el-icon-question"},null,-1),Q={class:"annotations-move"},W={class:"annotations-left"},X={class:"annotations-right"},Y={style:{"text-align":"right","padding-right":"14px"}},H=C("增加"),J=g("span",null,"是否启用",-1),Z=g("i",{class:"el-icon-question"},null,-1),ee=C("提交数据");y();const te=L(((e,t,l,a,n,s)=>{const i=D("el-tooltip"),o=D("el-input"),d=D("el-form-item"),u=D("el-option"),r=D("el-select"),c=D("el-button"),m=D("el-popconfirm"),h=D("el-card"),p=D("el-switch"),f=D("el-form");return v(),x(h,{class:"box-card","body-style":{padding:"0px 0px 0px 0px"}},{default:L((()=>[g("div",I,[g(f,{"label-position":"right",ref:"formRef",model:n.formData,"label-width":"170px",size:"small",disabled:n.formDisabled},{default:L((()=>[g(d,null,{label:L((()=>[S,g(i,{content:"警报规则的名称。alert: <string>",placement:"top"},{default:L((()=>[q])),_:1})])),default:L((()=>[g(o,{modelValue:n.formData.alert,"onUpdate:modelValue":t[1]||(t[1]=e=>n.formData.alert=e)},null,8,["modelValue"])])),_:1}),g(d,null,{label:L((()=>[U,g(i,{content:"使用PromQL表达式完成的警报触发条件，用于计算是否有满足触发条件。expr: <string>",placement:"top"},{default:L((()=>[N])),_:1})])),default:L((()=>[g(o,{type:"textarea",rows:6,maxlength:"5000","show-word-limit":"",modelValue:n.formData.expr,"onUpdate:modelValue":t[2]||(t[2]=e=>n.formData.expr=e)},null,8,["modelValue"])])),_:1}),g(d,null,{label:L((()=>[O,g(i,{content:"带有for子句的警报触发以后首先会先转换成 Pending 状态，然后在转换为 Firing 状态。这里需要俩个周期才能触发警报条件，如果没有设置 for 子句，会直接 Inactive 状态转换成 Firing状态，然后触发警报，发送给 Receiver 设置的通知人。for: <string>，如：for: 5m，(m代表分钟)",placement:"top","popper-class":"filed-explain"},{default:L((()=>[P])),_:1})])),default:L((()=>[g(o,{modelValue:n.formData.for,"onUpdate:modelValue":t[3]||(t[3]=e=>n.formData.for=e)},null,8,["modelValue"])])),_:1}),g(d,null,{label:L((()=>[T,g(i,{content:"自定义标签，允许自行定义标签附加在警报上。<lable_name>: <label_value>",placement:"top"},{default:L((()=>[j])),_:1})])),default:L((()=>[g("div",null,[(v(!0),x(k,null,_(n.formData.labels,(e=>(v(),x("div",{key:e.id},[g(h,{class:"box-card-two","body-style":{padding:"0px 0px 0px 0px"}},{default:L((()=>[g(r,{modelValue:e.key,"onUpdate:modelValue":t=>e.key=t,key:e.id,filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择",style:{width:"20%"}},{default:L((()=>[g(u,{label:e.key,value:e.key},null,8,["label","value"]),(v(!0),x(k,null,_(n.defaultLabels,(e=>(v(),x(u,{key:e.id,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),g(o,{style:{width:"77%"},modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,maxlength:"100","show-word-limit":"",key:e.id},null,8,["modelValue","onUpdate:modelValue"]),g(m,{title:"确定删除吗？",onConfirm:t=>s.delItem(e,"labels")},{reference:L((()=>[g(c,{type:"text",class:"el-icon-delete-solid icon-action",size:"mini"})])),_:2},1032,["onConfirm"])])),_:2},1024)])))),128)),g("div",A,[g(c,{type:"success",plain:"",size:"mini",icon:"el-icon-circle-plus",onClick:t[4]||(t[4]=e=>s.addLables(n.formData,"labels"))},{default:L((()=>[G])),_:1})])])])),_:1}),g(d,null,{label:L((()=>[B,g(i,{content:"用来设置有关警报的一组描述信息，其中包括自定义的标签，以及expr计算后的值。<lable_name>: <tmpl_string>",placement:"top","popper-class":"filed-explain"},{default:L((()=>[K])),_:1})])),default:L((()=>[g("div",null,[(v(!0),x(k,null,_(n.formData.annotations,(e=>(v(),x("div",{key:e.id},[g(h,{class:"box-card-two","body-style":{padding:"0px 0px 0px 0px"}},{default:L((()=>[g("div",Q,[g("div",W,[g(r,{modelValue:e.key,"onUpdate:modelValue":t=>e.key=t,key:e.id,"allow-create":"",filterable:"","default-first-option":"",placeholder:"请选择",style:{width:"100%"}},{default:L((()=>[g(u,{label:e.key,value:e.key},null,8,["label","value"]),(v(!0),x(k,null,_(n.defaultLabels,(e=>(v(),x(u,{key:e.id,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])]),g("div",X,[g(o,{type:"textarea",rows:2,maxlength:"500","show-word-limit":"",style:{width:"100%"},modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,key:e.id},null,8,["modelValue","onUpdate:modelValue"])]),g("div",null,[g(m,{title:"确定删除吗？",onConfirm:t=>s.delItem(e,"annotations")},{reference:L((()=>[g(c,{type:"text",class:"el-icon-delete-solid icon-action",size:"mini"})])),_:2},1032,["onConfirm"])])])])),_:2},1024)])))),128)),g("div",Y,[g(c,{type:"success",size:"mini",plain:"",onClick:t[5]||(t[5]=e=>s.addLables(n.formData,"annotations")),icon:"el-icon-circle-plus"},{default:L((()=>[H])),_:1})])])])),_:1}),g(d,null,{label:L((()=>[J,g(i,{content:"是否启用",placement:"top"},{default:L((()=>[Z])),_:1})])),default:L((()=>[g(p,{modelValue:n.formData.enabled,"onUpdate:modelValue":t[6]||(t[6]=e=>n.formData.enabled=e),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])])),_:1}),g(d,{align:"right"},{default:L((()=>[g(c,{style:{"margin-right":"10px"},icon:"el-icon-upload",type:"primary",size:"medium",onClick:s.onSubmit},{default:L((()=>[ee])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","disabled"])])])),_:1})}));z.render=te,z.__scopeId="data-v-0fdb36af";let le=1e3;const ae={name:"Notice",components:{RuleEdit:z},data:()=>({data:[],queryInfo:{},visible:!1,top:0,left:0,menuData:null,menuNode:null,titleFromShowMe:"",menuAddDisabled:!0,menuDelDisabled:!0,menuRenameDisabled:!0,labelPath:[],expandedList:[]}),mounted(){this.doGetTree()},watch:{visible(e){e?document.body.addEventListener("click",this.closeMenu):document.body.removeEventListener("click",this.closeMenu)}},methods:{doGetTree(){c().then((e=>{this.data=[...e.data]})).catch((e=>{console.log(e)}))},handleNodeClick(e){if(this.labelPath=e.path,4!==e.level)return this.$refs.ruleEditRef.resetForm(),this.$refs.ruleEditRef.setFormDisable(),!1;if(this.$refs.ruleEditRef.setFormEnable(),"[must rename me]"===e.label)return!1;const t={id:e.id,label:e.label,level:e.level,is_new:e.is_new,parent:e.parent};this.$refs.ruleEditRef.doGetRuleDetail(t)},append(e){e||(e=this.menuData);const t={id:le++,level:e.level+1,label:"[must rename me]",children:[],is_new:!0,parent:e.id,path:[...e.path]};t.path.push(t.label),e.children||(e.children=[]),e.children.push(t),this.data=[...this.data]},remove(e,t){e||(e=this.menuNode),t||(t=this.menuData),this.$confirm("是否确定删除？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"放弃"}).then((()=>{if(t.is_new){const l=e.parent,a=l.data.children||l.data,n=a.findIndex((e=>e.id===t.id));return a.splice(n,1),this.data=[...this.data],!0}const l={id:this.menuData.id,label:this.titleFromShowMe,level:this.menuData.level,parent:this.menuData.parent};m(l).then((l=>{this.$notify({title:"成功",message:"删除节点成功！",type:"success"});const a=e.parent,n=a.data.children||a.data,s=n.findIndex((e=>e.id===t.id));n.splice(s,1),this.data=[...this.data]})).catch((e=>{console.log(e)}))})).catch((()=>{}))},edit(e,t){t||(t=this.menuData),t.display=!0,this.titleFromShowMe=t.label},renderContent(e,{node:t,data:l,store:a}){return e("span",{class:"custom-tree-node"},e("span",null,t.label),e("span",null,e("a",{onClick:()=>this.append(l)},"Append "),e("a",{onClick:()=>this.remove(t,l)},"Delete")))},fatherMethod(e,t){e.path&&(this.labelPath=e.path),this.doGetTree()},openMenu(e,t,l){1===t.level?(this.menuDelDisabled=!0,this.menuRenameDisabled=!0,this.menuAddDisabled=!1):2===t.level||3===t.level?("[must rename me]"===t.label?this.menuAddDisabled=!0:this.menuAddDisabled=!1,this.menuDelDisabled=!1,this.menuRenameDisabled=!1):4===t.level?("[must rename me]"===t.label?this.menuRenameDisabled=!1:this.menuRenameDisabled=!0,this.menuDelDisabled=!1,this.menuAddDisabled=!0):(this.menuDelDisabled=!0,this.menuRenameDisabled=!0,this.menuAddDisabled=!0);const a=this.$el.getBoundingClientRect().left,n=this.$el.offsetWidth-105,s=e.clientX-a;this.left=s>n?n:s,this.top=e.clientY-40,this.left=this.left+20,this.menuData=t.valueOf(),this.menuNode=l.valueOf(),this.visible=!0},receiveEsc(){this.titleFromShowMe="",this.menuData.display=!1,this.data=[...this.data]},receiveEnter(){if("[must rename me]"===this.titleFromShowMe)return this.$notify({title:"错误",message:"请输入正确的名称！",type:"error"}),!1;const e={id:this.menuData.id,label:this.titleFromShowMe,level:this.menuData.level,parent:this.menuData.parent};this.menuData.is_new?h(e).then((e=>{this.$notify({title:"成功",message:"创建新节点成功！",type:"success"}),this.menuData.label=this.titleFromShowMe,this.titleFromShowMe="",this.menuData.display=!1,this.doGetTree()})).catch((e=>{console.log(e)})):p(e).then((e=>{this.$notify({title:"成功",message:"更新节点成功！",type:"success"}),this.menuData.label=this.titleFromShowMe,this.menuData.display=!1,this.titleFromShowMe="",this.doGetTree()})).catch((e=>{console.log(e)}))},closeMenu(){this.visible=!1},doRulesPublish(){f().then((e=>{this.$notify({title:"成功",message:"发布成功！",type:"success"})})).catch((e=>{console.log(e)}))},nodeExpand(e){this.expandedList.push(e.code)},nodeCollapse(e){this.expandedList.splice(this.expandedList.indexOf(e.code),1)}}},ne=w();b("data-v-3ff71afd");const se={class:"monitor-board"},ie={class:"tree-container"},oe={class:"tree-box"},de={class:"custom-tree-node"},ue={class:"node-content"},re={class:"node-content-top"},ce={class:"node-content-path"},me=C("路径："),he=C("发布"),pe={class:"node-content-edit"},fe={class:"rule-edit-box"},be=C("添加子节点"),ye=C("重命名此节点"),De=C("删除此节点");y();const ve=ne(((e,t,l,a,n,s)=>{const i=D("el-input"),o=D("el-tag"),d=D("el-tree"),u=D("el-scrollbar"),r=D("el-button"),c=D("RuleEdit");return v(),x("div",se,[g("div",ie,[g(u,{class:"card-scrollbar"},{default:ne((()=>[g("div",oe,[g(d,{"default-expanded-keys":n.expandedList,"node-key":"code",class:"tree",data:n.data,indent:0,"expand-on-click-node":!1,onNodeClick:s.handleNodeClick,onNodeExpand:s.nodeExpand,onNodeCollapse:s.nodeCollapse},{default:ne((({node:e,data:l})=>[g("span",de,[!0===l.display?(v(),x(i,{key:0,size:"mini",placeholder:"输入名称",modelValue:n.titleFromShowMe,"onUpdate:modelValue":t[1]||(t[1]=e=>n.titleFromShowMe=e),onKeyup:[M(s.receiveEnter,["enter"]),M(s.receiveEsc,["esc"])],clearable:""},null,8,["modelValue","onKeyup"])):V("",!0),1===l.level&&!0!==l.display?F((v(),x(o,{key:1,size:"small",type:"success",effect:"plain",onClick:s.closeMenu,onContextmenu:E((t=>s.openMenu(t,l,e)),["prevent"])},{default:ne((()=>[C($(e.label),1)])),_:2},1032,["onClick","onContextmenu"])),[[R,!0!==l.showMe]]):V("",!0),2===l.level?F((v(),x(o,{key:2,size:"small",type:"warning",effect:"plain",onClick:s.closeMenu,onContextmenu:E((t=>s.openMenu(t,l,e)),["prevent"])},{default:ne((()=>[C($(e.label),1)])),_:2},1032,["onClick","onContextmenu"])),[[R,!0!==l.showMe&&!0!==l.display]]):V("",!0),3===l.level?F((v(),x(o,{key:3,size:"small",type:"info",effect:"plain",onClick:s.closeMenu,onContextmenu:E((t=>s.openMenu(t,l,e)),["prevent"])},{default:ne((()=>[C($(e.label),1)])),_:2},1032,["onClick","onContextmenu"])),[[R,!0!==l.showMe&&!0!==l.display]]):V("",!0),4===l.level?F((v(),x(o,{key:4,size:"small",type:"info",effect:"plain",onClick:s.closeMenu,onContextmenu:E((t=>s.openMenu(t,l,e)),["prevent"])},{default:ne((()=>[C($(e.label),1)])),_:2},1032,["onClick","onContextmenu"])),[[R,!0!==l.showMe&&!0!==l.display]]):V("",!0)])])),_:1},8,["default-expanded-keys","data","onNodeClick","onNodeExpand","onNodeCollapse"])])])),_:1})]),g("div",ue,[g("div",re,[g("span",ce,[g(o,{size:"small",class:"path-all",type:"success"},{default:ne((()=>[me])),_:1}),g(o,{class:"path-list path-all",size:"small",type:"warning",effect:"plain"},{default:ne((()=>[C($(n.labelPath.join(" > ")),1)])),_:1})]),g("span",null,[g(r,{type:"primary",size:"mini",onClick:s.doRulesPublish},{default:ne((()=>[he])),_:1},8,["onClick"])])]),g("div",pe,[g(u,{class:"card-scrollbar-right"},{default:ne((()=>[g("div",fe,[g(c,{ref:"ruleEditRef",onFatherMethod:s.fatherMethod,query:n.queryInfo},null,8,["onFatherMethod","query"])])])),_:1})])]),F(g("ul",{style:{left:n.left+"px",top:n.top+"px"},class:"contextmenu"},[g("li",null,[g(r,{disabled:n.menuAddDisabled,size:"mini",type:"text",icon:"el-icon-plus",onClick:t[2]||(t[2]=e=>s.append(null))},{default:ne((()=>[be])),_:1},8,["disabled"])]),g("li",null,[g(r,{disabled:n.menuRenameDisabled,size:"mini",type:"text",icon:"el-icon-edit-outline",onClick:t[3]||(t[3]=e=>s.edit(null,null))},{default:ne((()=>[ye])),_:1},8,["disabled"])]),g("li",null,[g(r,{disabled:n.menuDelDisabled,size:"mini",type:"text",icon:"el-icon-delete",onClick:t[4]||(t[4]=e=>s.remove(null,null))},{default:ne((()=>[De])),_:1},8,["disabled"])])],4),[[R,n.visible]])])}));ae.render=ve,ae.__scopeId="data-v-3ff71afd";export default ae;
