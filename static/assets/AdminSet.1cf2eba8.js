import{m as e,n as l,o as a,q as o,r as s}from"./manager.77e83400.js";import{p as t,j as i,r as n,o as d,c as r,a as u,F as c,n as m,q as g,k as h,l as p}from"./vendor.02dbbba7.js";import"./request.10a66ff0.js";import"./index.24626b86.js";const f={data:()=>({params:{},groupList:[],dialogFormVisible:!1,ruleForm:{code:""},rules:{code:[{required:!0,message:"请输入重置码！",trigger:"blur"}]},runningMod:!1}),mounted(){this.selectChanged=!1,this.doGetParams()},methods:{doGetParams(){e().then((e=>{this.groupList=e.data,l().then((e=>{Object.keys(e.data).forEach((l=>{if("default_group"===l){var a=this.groupList.findIndex(((a,o)=>a.id.toString()===e.data[l]));this.params[l]=-1===a?"":this.groupList[a].name}}))})).catch((e=>console.log(e)))})).catch((e=>console.log(e)))},doPutAdminSetting(e){if(this.selectChanged&&!e){let e={};Object.keys(this.params).forEach((l=>{e[l]=this.params[l].toString()})),a(e).then((e=>{this.$notify({title:"成功",message:"参数提交成功",type:"success"}),this.selectChanged=!1})).catch((e=>console.log(e)))}},selectChange(){this.selectChanged=!0},showResetDialog(){o().then((e=>{this.$notify({title:"警告",message:"已经生成新的重置码！",type:"warning"}),this.ruleForm.code="",this.dialogFormVisible=!0}))},closeDialog(e){this.dialogFormVisible=!1},doResetAdmin(e){this.runningMod=!0,this.$refs[e].validate((e=>{e?s(this.ruleForm).then((e=>{this.$notify({title:"成功",message:"重置成功！",type:"success"}),this.runningMod=!1,this.doGetOperateLog()})).catch((e=>{console.log(e),this.runningMod=!1,this.doGetOperateLog()})):(this.runningMod=!1,console.log(`validate: ${e}`))}))}}},b=h();t("data-v-c3ff7c3a");const y={class:"admin-set-board"},_=u("i",{class:"el-icon-s-custom"},null,-1),C=p(" 当在调整用户所属组时，未被设置的用户默认指向的组 "),F=u("i",{class:"el-icon-refresh-left"},null,-1),V=p(" 重置用户及权限管理成出产设置 "),v=p(" 重置数据 "),k=u("div",{class:"reset-explain"},[u("p",null,"系統会在后台生成一个重置码，可以在服务的日志中看到，如："),u("p",{style:{"font-width":"bold"}},[p(" reset "),u("span",{style:{color:"blue"}},"admin"),p(" config key: "),u("span",{style:{color:"red"}},"6eb96669-2fb1-4758-8776-ddcdb58405c9")]),u("p",null,"输入红色部分的KEY即可重置成出产设置")],-1),j={class:"dialog-footer"},z=p("关 闭"),L=p("确 定"),M=p("确 定");i();const w=b(((e,l,a,o,s,t)=>{const i=n("el-option"),h=n("el-select"),p=n("el-descriptions-item"),f=n("el-button"),w=n("el-descriptions"),x=n("el-input"),A=n("el-form-item"),P=n("el-form"),S=n("el-dialog");return d(),r("div",y,[u(w,{class:"margin-top",column:1,size:"mini",border:""},{default:b((()=>[u(p,null,{label:b((()=>[_,C])),default:b((()=>[u(h,{size:"small",modelValue:s.params.default_group,"onUpdate:modelValue":l[1]||(l[1]=e=>s.params.default_group=e),clearable:"",placeholder:"请选择",onVisibleChange:t.doPutAdminSetting,onClear:t.doPutAdminSetting,onChange:t.selectChange},{default:b((()=>[(d(!0),r(c,null,m(s.groupList,(e=>(d(),r(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onVisibleChange","onClear","onChange"])])),_:1}),u(p,null,{label:b((()=>[F,V])),default:b((()=>[u(f,{size:"small",type:"danger",onClick:t.showResetDialog},{default:b((()=>[v])),_:1},8,["onClick"])])),_:1})])),_:1}),u("div",null,[u(S,{title:"输入重置码",modelValue:s.dialogFormVisible,"onUpdate:modelValue":l[5]||(l[5]=e=>s.dialogFormVisible=e),width:"430px"},{default:b((()=>[k,u(P,{model:s.ruleForm,rules:s.rules,ref:"ruleForm","label-width":"auto",class:"demo-ruleForm",size:"mini"},{default:b((()=>[u(A,{label:"重置码",prop:"code"},{default:b((()=>[u(x,{modelValue:s.ruleForm.code,"onUpdate:modelValue":l[2]||(l[2]=e=>s.ruleForm.code=e)},null,8,["modelValue"])])),_:1}),u(A,null,{default:b((()=>[u("div",j,[u(f,{size:"small",onClick:l[3]||(l[3]=e=>t.closeDialog("ruleForm"))},{default:b((()=>[z])),_:1}),!0===s.runningMod?(d(),r(f,{key:0,size:"small",type:"primary",icon:"el-icon-loading"},{default:b((()=>[L])),_:1})):g("",!0),!1===s.runningMod?(d(),r(f,{key:1,size:"small",type:"primary",icon:"el-icon-refresh",onClick:l[4]||(l[4]=e=>t.doResetAdmin("ruleForm"))},{default:b((()=>[M])),_:1})):g("",!0)])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])])}));f.render=w,f.__scopeId="data-v-c3ff7c3a";export default f;
