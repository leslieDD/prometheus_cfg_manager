webpackJsonp([1],{NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={};n.d(o,"parseTime",function(){return $}),n.d(o,"formatTime",function(){return z}),n.d(o,"timeAgo",function(){return A}),n.d(o,"numberFormatter",function(){return P}),n.d(o,"toThousandFilter",function(){return T}),n.d(o,"uppercaseFirst",function(){return V});var a=n("fZjL"),r=n.n(a),i=n("7+uW"),s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{"margin-top":"0px"},attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var l=n("VU/8")({name:"App"},s,!1,function(e){n("kb9S")},null,null).exports,c=n("/ocq"),u=n("Dd8w"),d=n.n(u),p=n("//Fk"),f=n.n(p),h=n("mtWM"),g=n.n(h),m=n("zL8q"),v=n.n(m),b=g.a.create({baseURL:Object({NODE_ENV:"production"}).VUE_APP_BASE_API,timeout:5e3});b.interceptors.request.use(function(e){return e},function(e){return f.a.reject(e)}),b.interceptors.response.use(function(e){var t=e.data;return 2e5!==t.code?(Object(m.Message)({message:t.msg||"Error",type:"error",duration:5e3}),f.a.reject(new Error(t.msg||"Error"))):t},function(e){return console.log("err"+e),Object(m.Message)({message:e.message,type:"error",duration:5e3}),f.a.reject(e)});var y=b;function _(){return y({url:"/v1/jobs",method:"get"})}function M(e){return y({url:"/v1/machine",method:"post",data:e})}var S={name:"Manager",data:function(){return{machines:[],jobs:[],jobsMap:{},selectTypeValue:{},search:"",pageSize:15,pageTotal:0,currentPage:1,selectOption:"1",searchContent:"",dialogVisible:!1,addMechineInfo:{ipAddr:"",jobId:""},rules:{ipAddr:[{required:!0,message:"请输入正确的IP地址",validator:function(e,t,n){""===t||void 0===t||null==t?n(new Error("请输入正确的IP地址")):/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(t)||""===t?n():n(new Error("请输入正确的IP地址"))},trigger:"blur"}],jobId:[{required:!0,message:"请选择分组",trigger:["blur","change"]}]}}},created:function(){this.doGetMechines()},methods:{doAdd:function(){this.dialogVisible=!0},doGetJobs:function(){var e=this;_().then(function(t){e.jobs=t.data,t.data.forEach(function(t){e.jobsMap[t.id]=t.name})}).catch(function(e){console.log(e)})},doGetMechines:function(e){var t=this;_().then(function(n){var o;t.jobs=n.data,n.data.forEach(function(e){t.jobsMap[e.id]=e.name}),e||(e={pageNo:t.currentPage,pageSize:t.pageSize,search:t.searchContent,option:t.selectOption}),(o=e,y({url:"/v1/machines",method:"get",params:o})).then(function(e){t.pageTotal=e.data.totalCount,t.machines=e.data.data,e.data.data.forEach(function(e){t.selectTypeValue[e.id]=t.jobsMap[e.job_id[0]]})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},handleSelect:function(e,t){var n,o=this,a={};a.id=t.id,a.ipaddr=t.ipaddr,a.job_id=[this.selectTypeValue[t.id]],(n=a,y({url:"/v1/machine",method:"put",data:n})).then(function(e){o.$message({showClose:!0,message:"更新成功！",type:"success"}),o.selectTypeValue=d()({},o.selectTypeValue)}).catch(function(e){console.log(e)})},handleSizeChange:function(e){var t={pageNo:this.currentPage,pageSize:e,search:this.searchContent,option:this.selectOption};this.doGetMechines(t)},handleCurrentChange:function(e){var t={pageNo:e,pageSize:this.pageSize,search:this.searchContent,option:this.selectOption};this.doGetMechines(t)},handleClose:function(e){this.dialogVisible=!1},onSubmitAndContinue:function(e){var t=this;this.$refs[e].validate(function(n){if(!n)return!1;var o={};o.ipaddr=t.addMechineInfo.ipAddr,o.job_id=[parseInt(t.addMechineInfo.jobId)],M(o).then(function(n){t.$message({showClose:!0,message:"创建成功！",type:"success"}),t.doGetMechines(),t.$refs[e].resetFields()}).catch(function(e){console.log(e)})})},onSubmit:function(e){var t=this;this.$refs[e].validate(function(n){if(!n)return!1;var o={};o.ipaddr=t.addMechineInfo.ipAddr,o.job_id=[parseInt(t.addMechineInfo.jobId)],M(o).then(function(n){t.$message({showClose:!0,message:"创建成功！",type:"success"}),t.doGetMechines(),t.dialogVisible=!1,t.$refs[e].resetFields()}).catch(function(e){console.log(e)})})},onCancel:function(e){this.dialogVisible=!1,this.$refs[e].resetFields()},onSearch:function(){this.doGetMechines()},onPublish:function(){var e=this;y({url:"/v1/publish",method:"post"}).then(function(t){e.$message({showClose:!0,message:"发布成功！",type:"success"})}).catch(function(e){console.log(e)})},parseTimeSelf:function(e){return new Date(Date.parse(e)).toLocaleString()},doYes:function(e){var t,n=this;(t=e.row.id,y({url:"/v1/machine",method:"delete",params:{id:t}})).then(function(e){n.$message({showClose:!0,message:"删除成功！",type:"success"}),n.doGetMechines()}).catch(function(e){console.log(e)}),e._self.$refs["popover-"+e.$index].doClose()},doNo:function(e){e._self.$refs["popover-"+e.$index].doClose()}}},I={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("dir",{staticClass:"main-board"},[[n("el-tabs",{attrs:{type:"border-card"}},[n("el-tab-pane",{attrs:{label:"IP管理"}},[n("div",{staticClass:"do_action"},[n("div",{staticStyle:{"padding-right":"15px"}},[n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.onPublish()}}},[e._v("发布")]),e._v(" "),n("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.doAdd()}}},[e._v("添加")])],1),e._v(" "),n("div",[n("el-input",{staticClass:"input-with-select",attrs:{size:"small",placeholder:"请输入内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch()}},model:{value:e.searchContent,callback:function(t){e.searchContent=t},expression:"searchContent"}},[n("el-select",{staticClass:"searchSelect",attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.selectOption,callback:function(t){e.selectOption=t},expression:"selectOption"}},[n("el-option",{attrs:{label:"IP地址",value:"1"}}),e._v(" "),n("el-option",{attrs:{label:"分组",value:"2"}})],1),e._v(" "),n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.onSearch()}},slot:"append"})],1)],1)]),e._v(" "),n("el-table",{attrs:{size:"mini","highlight-current-row":"",border:"",stripe:"",data:e.machines,"row-style":{height:"0"},"cell-style":{padding:"0"}}},[n("el-table-column",{attrs:{label:"序号",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.$index+1)+"\n          ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"IP地址",prop:"ipaddr"}}),e._v(" "),n("el-table-column",{attrs:{label:"分组选项",prop:"job_id"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-select",{attrs:{size:"small",placeholder:"请选择"},on:{change:function(n){return e.handleSelect(t.$index,t.row)}},model:{value:e.selectTypeValue[t.row.id],callback:function(n){e.$set(e.selectTypeValue,t.row.id,n)},expression:"selectTypeValue[scope.row.id]"}},e._l(e.jobs,function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"最后更新时间",prop:"update_at"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[n("span",[e._v(e._s(e.parseTimeSelf(o.update_at)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-popover",{ref:"popover-"+t.$index,attrs:{trigger:"click",placement:"top",width:"160"}},[n("p",[e._v("确定删除吗？")]),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(n){return e.doNo(t)}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){return e.doYes(t)}}},[e._v("确定")])],1),e._v(" "),n("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),n("div",{staticClass:"block"},[n("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,15,30,50],"page-size":e.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.pageTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)],e._v(" "),n("el-dialog",{attrs:{title:"新增IP地址",visible:e.dialogVisible,width:"400px",modal:"","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("span",[n("el-form",{ref:"addMechineInfo",attrs:{"label-position":"right",rules:e.rules,model:e.addMechineInfo,"label-width":"90px",size:"small"}},[n("el-form-item",{attrs:{label:"IP地址：",prop:"ipAddr"}},[n("el-input",{staticStyle:{width:"230px"},model:{value:e.addMechineInfo.ipAddr,callback:function(t){e.$set(e.addMechineInfo,"ipAddr",t)},expression:"addMechineInfo.ipAddr"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"分组名：",prop:"jobId"}},[n("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择"},model:{value:e.addMechineInfo.jobId,callback:function(t){e.$set(e.addMechineInfo,"jobId",t)},expression:"addMechineInfo.jobId"}},e._l(e.jobs,function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{size:"small"}},[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onSubmitAndContinue("addMechineInfo")}}},[e._v("创建并继续")]),e._v(" "),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onSubmit("addMechineInfo")}}},[e._v("创建")]),e._v(" "),n("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){return e.onCancel("addMechineInfo")}}},[e._v("取消")])],1)],1)],1)])],2)},staticRenderFns:[]};var w=n("VU/8")(S,I,!1,function(e){n("rcM3")},"data-v-69fcc148",null).exports;i.default.use(c.a);var C=new c.a({routes:[{path:"/",name:"Manager",component:w}]}),j=(n("tvR6"),n("lHA8"),n("c/Tr"),n("pFYg")),k=n.n(j);function $(e,t){if(0===arguments.length||!e)return null;var n=t||"{y}-{m}-{d} {h}:{i}:{s}",o=void 0;"object"===(void 0===e?"undefined":k()(e))?o=e:("string"==typeof e&&(e=/^[0-9]+$/.test(e)?parseInt(e):e.replace(new RegExp(/-/gm),"/")),"number"==typeof e&&10===e.toString().length&&(e*=1e3),o=new Date(e));var a={y:o.getFullYear(),m:o.getMonth()+1,d:o.getDate(),h:o.getHours(),i:o.getMinutes(),s:o.getSeconds(),a:o.getDay()};return n.replace(/{([ymdhisa])+}/g,function(e,t){var n=a[t];return"a"===t?["日","一","二","三","四","五","六"][n]:n.toString().padStart(2,"0")})}function z(e,t){e=10===(""+e).length?1e3*parseInt(e):+e;var n=new Date(e),o=(Date.now()-n)/1e3;return o<30?"刚刚":o<3600?Math.ceil(o/60)+"分钟前":o<86400?Math.ceil(o/3600)+"小时前":o<172800?"1天前":t?$(e,t):n.getMonth()+1+"月"+n.getDate()+"日"+n.getHours()+"时"+n.getMinutes()+"分"}function x(e,t){return 1===e?e+t:e+t+"s"}function A(e){var t=Date.now()/1e3-Number(e);return t<3600?x(~~(t/60)," minute"):t<86400?x(~~(t/3600)," hour"):x(~~(t/86400)," day")}function P(e,t){for(var n=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}],o=0;o<n.length;o++)if(e>=n[o].value)return(e/n[o].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+n[o].symbol;return e.toString()}function T(e){return(+e||0).toString().replace(/^-?\d+/g,function(e){return e.replace(/(?=(?!\b)(\d{3})+$)/g,",")})}function V(e){return e.charAt(0).toUpperCase()+e.slice(1)}r()(o).forEach(function(e){i.default.filter(e,o[e])}),i.default.config.productionTip=!1,i.default.use(v.a),new i.default({el:"#app",router:C,components:{App:l},template:"<App/>"})},kb9S:function(e,t){},rcM3:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.09f8c90057489304e052.js.map